<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html"><link rel="search" title="Search" href="../../search.html">

    <!-- Generated with Sphinx 9.1.0 and Furo 2025.12.19 -->
        <title>ray.actor - deisa-ray documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=7bdb33bb" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">deisa-ray  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <span class="sidebar-brand-text">deisa-ray  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analytics.html">Analytics</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for ray.actor</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Literal</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
    <span class="n">TYPE_CHECKING</span><span class="p">,</span>
    <span class="n">TypeVar</span><span class="p">,</span>
    <span class="n">Generic</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">overload</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">ParamSpec</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Concatenate</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ParamSpec</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Concatenate</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">ray._private.ray_constants</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ray_constants</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ray._common.signature</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">signature</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ray._raylet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ray</span><span class="w"> </span><span class="kn">import</span> <span class="n">ActorClassID</span><span class="p">,</span> <span class="n">Language</span><span class="p">,</span> <span class="n">cross_language</span><span class="p">,</span> <span class="n">ObjectRef</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ray._private</span><span class="w"> </span><span class="kn">import</span> <span class="n">ray_option_utils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ray._private.async_compat</span><span class="w"> </span><span class="kn">import</span> <span class="n">has_async_methods</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ray._private.auto_init_hook</span><span class="w"> </span><span class="kn">import</span> <span class="n">wrap_auto_init</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ray._private.client_mode_hook</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">client_mode_convert_actor</span><span class="p">,</span>
    <span class="n">client_mode_hook</span><span class="p">,</span>
    <span class="n">client_mode_should_convert</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ray._private.inspect_util</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">is_class_method</span><span class="p">,</span>
    <span class="n">is_function_or_method</span><span class="p">,</span>
    <span class="n">is_static_method</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ray._private.ray_option_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">_warn_if_using_deprecated_placement_group</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ray._private.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_runtime_env_info</span><span class="p">,</span> <span class="n">parse_runtime_env_for_task_or_actor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ray._raylet</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">STREAMING_GENERATOR_RETURN</span><span class="p">,</span>
    <span class="n">ObjectRefGenerator</span><span class="p">,</span>
    <span class="n">PythonFunctionDescriptor</span><span class="p">,</span>
    <span class="n">raise_sys_exit_with_custom_error_message</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ray.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncioActorExit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ray.util.annotations</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeveloperAPI</span><span class="p">,</span> <span class="n">PublicAPI</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ray.util.placement_group</span><span class="w"> </span><span class="kn">import</span> <span class="n">_configure_placement_group_based_on_context</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ray.util.scheduling_strategies</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">PlacementGroupSchedulingStrategy</span><span class="p">,</span>
    <span class="n">SchedulingStrategyT</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ray.util.tracing.tracing_helper</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">_inject_tracing_into_class</span><span class="p">,</span>
    <span class="n">_tracing_actor_creation</span><span class="p">,</span>
    <span class="n">_tracing_actor_method_invocation</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ray._private.custom_types</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">TensorTransportEnum</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Hook to call with (actor, resources, strategy) on each local actor creation.</span>
<span class="n">_actor_launch_hook</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># TypeVar for generic ActorHandle</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>

<span class="c1"># return type of ActorClass[T].remote()</span>
<span class="n">ActorProxy</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;ActorHandle[T]&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span>

<span class="n">_Ret</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_Ret&quot;</span><span class="p">)</span>
<span class="n">_P</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;_P&quot;</span><span class="p">)</span>
<span class="n">_T0</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T0&quot;</span><span class="p">)</span>
<span class="n">_T1</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T1&quot;</span><span class="p">)</span>
<span class="n">_T2</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T2&quot;</span><span class="p">)</span>
<span class="n">_T3</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T3&quot;</span><span class="p">)</span>
<span class="n">_T4</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T4&quot;</span><span class="p">)</span>
<span class="n">_T5</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T5&quot;</span><span class="p">)</span>
<span class="n">_T6</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T6&quot;</span><span class="p">)</span>
<span class="n">_T7</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T7&quot;</span><span class="p">)</span>
<span class="n">_T8</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T8&quot;</span><span class="p">)</span>
<span class="n">_T9</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T9&quot;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_RemoteMethodNoArgs</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">_Ret</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remote</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ObjectRef[_Ret]&quot;</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="o">...</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_RemoteMethod0</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__arg0</span><span class="p">:</span> <span class="s2">&quot;Union[_T0, ObjectRef[_T0]]&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ObjectRef[_Ret]&quot;</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__arg0</span><span class="p">:</span> <span class="n">_T0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="o">...</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_RemoteMethod1</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remote</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">__arg0</span><span class="p">:</span> <span class="s2">&quot;Union[_T0, ObjectRef[_T0]]&quot;</span><span class="p">,</span> <span class="n">__arg1</span><span class="p">:</span> <span class="s2">&quot;Union[_T1, ObjectRef[_T1]]&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ObjectRef[_Ret]&quot;</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__arg0</span><span class="p">:</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">__arg1</span><span class="p">:</span> <span class="n">_T1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="o">...</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_RemoteMethod2</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remote</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">__arg0</span><span class="p">:</span> <span class="s2">&quot;Union[_T0, ObjectRef[_T0]]&quot;</span><span class="p">,</span>
        <span class="n">__arg1</span><span class="p">:</span> <span class="s2">&quot;Union[_T1, ObjectRef[_T1]]&quot;</span><span class="p">,</span>
        <span class="n">__arg2</span><span class="p">:</span> <span class="s2">&quot;Union[_T2, ObjectRef[_T2]]&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ObjectRef[_Ret]&quot;</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__arg0</span><span class="p">:</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">__arg1</span><span class="p">:</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">__arg2</span><span class="p">:</span> <span class="n">_T2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="o">...</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_RemoteMethod3</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remote</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">__arg0</span><span class="p">:</span> <span class="s2">&quot;Union[_T0, ObjectRef[_T0]]&quot;</span><span class="p">,</span>
        <span class="n">__arg1</span><span class="p">:</span> <span class="s2">&quot;Union[_T1, ObjectRef[_T1]]&quot;</span><span class="p">,</span>
        <span class="n">__arg2</span><span class="p">:</span> <span class="s2">&quot;Union[_T2, ObjectRef[_T2]]&quot;</span><span class="p">,</span>
        <span class="n">__arg3</span><span class="p">:</span> <span class="s2">&quot;Union[_T3, ObjectRef[_T3]]&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ObjectRef[_Ret]&quot;</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__arg0</span><span class="p">:</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">__arg1</span><span class="p">:</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">__arg2</span><span class="p">:</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">__arg3</span><span class="p">:</span> <span class="n">_T3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="o">...</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_RemoteMethod4</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remote</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">__arg0</span><span class="p">:</span> <span class="s2">&quot;Union[_T0, ObjectRef[_T0]]&quot;</span><span class="p">,</span>
        <span class="n">__arg1</span><span class="p">:</span> <span class="s2">&quot;Union[_T1, ObjectRef[_T1]]&quot;</span><span class="p">,</span>
        <span class="n">__arg2</span><span class="p">:</span> <span class="s2">&quot;Union[_T2, ObjectRef[_T2]]&quot;</span><span class="p">,</span>
        <span class="n">__arg3</span><span class="p">:</span> <span class="s2">&quot;Union[_T3, ObjectRef[_T3]]&quot;</span><span class="p">,</span>
        <span class="n">__arg4</span><span class="p">:</span> <span class="s2">&quot;Union[_T4, ObjectRef[_T4]]&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ObjectRef[_Ret]&quot;</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">__arg0</span><span class="p">:</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">__arg1</span><span class="p">:</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">__arg2</span><span class="p">:</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">__arg3</span><span class="p">:</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">__arg4</span><span class="p">:</span> <span class="n">_T4</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="o">...</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_RemoteMethod5</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">,</span> <span class="n">_T5</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remote</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">__arg0</span><span class="p">:</span> <span class="s2">&quot;Union[_T0, ObjectRef[_T0]]&quot;</span><span class="p">,</span>
        <span class="n">__arg1</span><span class="p">:</span> <span class="s2">&quot;Union[_T1, ObjectRef[_T1]]&quot;</span><span class="p">,</span>
        <span class="n">__arg2</span><span class="p">:</span> <span class="s2">&quot;Union[_T2, ObjectRef[_T2]]&quot;</span><span class="p">,</span>
        <span class="n">__arg3</span><span class="p">:</span> <span class="s2">&quot;Union[_T3, ObjectRef[_T3]]&quot;</span><span class="p">,</span>
        <span class="n">__arg4</span><span class="p">:</span> <span class="s2">&quot;Union[_T4, ObjectRef[_T4]]&quot;</span><span class="p">,</span>
        <span class="n">__arg5</span><span class="p">:</span> <span class="s2">&quot;Union[_T5, ObjectRef[_T5]]&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ObjectRef[_Ret]&quot;</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">__arg0</span><span class="p">:</span> <span class="n">_T0</span><span class="p">,</span>
        <span class="n">__arg1</span><span class="p">:</span> <span class="n">_T1</span><span class="p">,</span>
        <span class="n">__arg2</span><span class="p">:</span> <span class="n">_T2</span><span class="p">,</span>
        <span class="n">__arg3</span><span class="p">:</span> <span class="n">_T3</span><span class="p">,</span>
        <span class="n">__arg4</span><span class="p">:</span> <span class="n">_T4</span><span class="p">,</span>
        <span class="n">__arg5</span><span class="p">:</span> <span class="n">_T5</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="o">...</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_RemoteMethod6</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">,</span> <span class="n">_T5</span><span class="p">,</span> <span class="n">_T6</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remote</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">__arg0</span><span class="p">:</span> <span class="s2">&quot;Union[_T0, ObjectRef[_T0]]&quot;</span><span class="p">,</span>
        <span class="n">__arg1</span><span class="p">:</span> <span class="s2">&quot;Union[_T1, ObjectRef[_T1]]&quot;</span><span class="p">,</span>
        <span class="n">__arg2</span><span class="p">:</span> <span class="s2">&quot;Union[_T2, ObjectRef[_T2]]&quot;</span><span class="p">,</span>
        <span class="n">__arg3</span><span class="p">:</span> <span class="s2">&quot;Union[_T3, ObjectRef[_T3]]&quot;</span><span class="p">,</span>
        <span class="n">__arg4</span><span class="p">:</span> <span class="s2">&quot;Union[_T4, ObjectRef[_T4]]&quot;</span><span class="p">,</span>
        <span class="n">__arg5</span><span class="p">:</span> <span class="s2">&quot;Union[_T5, ObjectRef[_T5]]&quot;</span><span class="p">,</span>
        <span class="n">__arg6</span><span class="p">:</span> <span class="s2">&quot;Union[_T6, ObjectRef[_T6]]&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ObjectRef[_Ret]&quot;</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">__arg0</span><span class="p">:</span> <span class="n">_T0</span><span class="p">,</span>
        <span class="n">__arg1</span><span class="p">:</span> <span class="n">_T1</span><span class="p">,</span>
        <span class="n">__arg2</span><span class="p">:</span> <span class="n">_T2</span><span class="p">,</span>
        <span class="n">__arg3</span><span class="p">:</span> <span class="n">_T3</span><span class="p">,</span>
        <span class="n">__arg4</span><span class="p">:</span> <span class="n">_T4</span><span class="p">,</span>
        <span class="n">__arg5</span><span class="p">:</span> <span class="n">_T5</span><span class="p">,</span>
        <span class="n">__arg6</span><span class="p">:</span> <span class="n">_T6</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="o">...</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_RemoteMethod7</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">,</span> <span class="n">_T5</span><span class="p">,</span> <span class="n">_T6</span><span class="p">,</span> <span class="n">_T7</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remote</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">__arg0</span><span class="p">:</span> <span class="s2">&quot;Union[_T0, ObjectRef[_T0]]&quot;</span><span class="p">,</span>
        <span class="n">__arg1</span><span class="p">:</span> <span class="s2">&quot;Union[_T1, ObjectRef[_T1]]&quot;</span><span class="p">,</span>
        <span class="n">__arg2</span><span class="p">:</span> <span class="s2">&quot;Union[_T2, ObjectRef[_T2]]&quot;</span><span class="p">,</span>
        <span class="n">__arg3</span><span class="p">:</span> <span class="s2">&quot;Union[_T3, ObjectRef[_T3]]&quot;</span><span class="p">,</span>
        <span class="n">__arg4</span><span class="p">:</span> <span class="s2">&quot;Union[_T4, ObjectRef[_T4]]&quot;</span><span class="p">,</span>
        <span class="n">__arg5</span><span class="p">:</span> <span class="s2">&quot;Union[_T5, ObjectRef[_T5]]&quot;</span><span class="p">,</span>
        <span class="n">__arg6</span><span class="p">:</span> <span class="s2">&quot;Union[_T6, ObjectRef[_T6]]&quot;</span><span class="p">,</span>
        <span class="n">__arg7</span><span class="p">:</span> <span class="s2">&quot;Union[_T7, ObjectRef[_T7]]&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ObjectRef[_Ret]&quot;</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">__arg0</span><span class="p">:</span> <span class="n">_T0</span><span class="p">,</span>
        <span class="n">__arg1</span><span class="p">:</span> <span class="n">_T1</span><span class="p">,</span>
        <span class="n">__arg2</span><span class="p">:</span> <span class="n">_T2</span><span class="p">,</span>
        <span class="n">__arg3</span><span class="p">:</span> <span class="n">_T3</span><span class="p">,</span>
        <span class="n">__arg4</span><span class="p">:</span> <span class="n">_T4</span><span class="p">,</span>
        <span class="n">__arg5</span><span class="p">:</span> <span class="n">_T5</span><span class="p">,</span>
        <span class="n">__arg6</span><span class="p">:</span> <span class="n">_T6</span><span class="p">,</span>
        <span class="n">__arg7</span><span class="p">:</span> <span class="n">_T7</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="o">...</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_RemoteMethod8</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">,</span> <span class="n">_T5</span><span class="p">,</span> <span class="n">_T6</span><span class="p">,</span> <span class="n">_T7</span><span class="p">,</span> <span class="n">_T8</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remote</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">__arg0</span><span class="p">:</span> <span class="s2">&quot;Union[_T0, ObjectRef[_T0]]&quot;</span><span class="p">,</span>
        <span class="n">__arg1</span><span class="p">:</span> <span class="s2">&quot;Union[_T1, ObjectRef[_T1]]&quot;</span><span class="p">,</span>
        <span class="n">__arg2</span><span class="p">:</span> <span class="s2">&quot;Union[_T2, ObjectRef[_T2]]&quot;</span><span class="p">,</span>
        <span class="n">__arg3</span><span class="p">:</span> <span class="s2">&quot;Union[_T3, ObjectRef[_T3]]&quot;</span><span class="p">,</span>
        <span class="n">__arg4</span><span class="p">:</span> <span class="s2">&quot;Union[_T4, ObjectRef[_T4]]&quot;</span><span class="p">,</span>
        <span class="n">__arg5</span><span class="p">:</span> <span class="s2">&quot;Union[_T5, ObjectRef[_T5]]&quot;</span><span class="p">,</span>
        <span class="n">__arg6</span><span class="p">:</span> <span class="s2">&quot;Union[_T6, ObjectRef[_T6]]&quot;</span><span class="p">,</span>
        <span class="n">__arg7</span><span class="p">:</span> <span class="s2">&quot;Union[_T7, ObjectRef[_T7]]&quot;</span><span class="p">,</span>
        <span class="n">__arg8</span><span class="p">:</span> <span class="s2">&quot;Union[_T8, ObjectRef[_T8]]&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ObjectRef[_Ret]&quot;</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">__arg0</span><span class="p">:</span> <span class="n">_T0</span><span class="p">,</span>
        <span class="n">__arg1</span><span class="p">:</span> <span class="n">_T1</span><span class="p">,</span>
        <span class="n">__arg2</span><span class="p">:</span> <span class="n">_T2</span><span class="p">,</span>
        <span class="n">__arg3</span><span class="p">:</span> <span class="n">_T3</span><span class="p">,</span>
        <span class="n">__arg4</span><span class="p">:</span> <span class="n">_T4</span><span class="p">,</span>
        <span class="n">__arg5</span><span class="p">:</span> <span class="n">_T5</span><span class="p">,</span>
        <span class="n">__arg6</span><span class="p">:</span> <span class="n">_T6</span><span class="p">,</span>
        <span class="n">__arg7</span><span class="p">:</span> <span class="n">_T7</span><span class="p">,</span>
        <span class="n">__arg8</span><span class="p">:</span> <span class="n">_T8</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="o">...</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_RemoteMethod9</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">,</span> <span class="n">_T5</span><span class="p">,</span> <span class="n">_T6</span><span class="p">,</span> <span class="n">_T7</span><span class="p">,</span> <span class="n">_T8</span><span class="p">,</span> <span class="n">_T9</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remote</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">__arg0</span><span class="p">:</span> <span class="s2">&quot;Union[_T0, ObjectRef[_T0]]&quot;</span><span class="p">,</span>
        <span class="n">__arg1</span><span class="p">:</span> <span class="s2">&quot;Union[_T1, ObjectRef[_T1]]&quot;</span><span class="p">,</span>
        <span class="n">__arg2</span><span class="p">:</span> <span class="s2">&quot;Union[_T2, ObjectRef[_T2]]&quot;</span><span class="p">,</span>
        <span class="n">__arg3</span><span class="p">:</span> <span class="s2">&quot;Union[_T3, ObjectRef[_T3]]&quot;</span><span class="p">,</span>
        <span class="n">__arg4</span><span class="p">:</span> <span class="s2">&quot;Union[_T4, ObjectRef[_T4]]&quot;</span><span class="p">,</span>
        <span class="n">__arg5</span><span class="p">:</span> <span class="s2">&quot;Union[_T5, ObjectRef[_T5]]&quot;</span><span class="p">,</span>
        <span class="n">__arg6</span><span class="p">:</span> <span class="s2">&quot;Union[_T6, ObjectRef[_T6]]&quot;</span><span class="p">,</span>
        <span class="n">__arg7</span><span class="p">:</span> <span class="s2">&quot;Union[_T7, ObjectRef[_T7]]&quot;</span><span class="p">,</span>
        <span class="n">__arg8</span><span class="p">:</span> <span class="s2">&quot;Union[_T8, ObjectRef[_T8]]&quot;</span><span class="p">,</span>
        <span class="n">__arg9</span><span class="p">:</span> <span class="s2">&quot;Union[_T9, ObjectRef[_T9]]&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ObjectRef[_Ret]&quot;</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">__arg0</span><span class="p">:</span> <span class="n">_T0</span><span class="p">,</span>
        <span class="n">__arg1</span><span class="p">:</span> <span class="n">_T1</span><span class="p">,</span>
        <span class="n">__arg2</span><span class="p">:</span> <span class="n">_T2</span><span class="p">,</span>
        <span class="n">__arg3</span><span class="p">:</span> <span class="n">_T3</span><span class="p">,</span>
        <span class="n">__arg4</span><span class="p">:</span> <span class="n">_T4</span><span class="p">,</span>
        <span class="n">__arg5</span><span class="p">:</span> <span class="n">_T5</span><span class="p">,</span>
        <span class="n">__arg6</span><span class="p">:</span> <span class="n">_T6</span><span class="p">,</span>
        <span class="n">__arg7</span><span class="p">:</span> <span class="n">_T7</span><span class="p">,</span>
        <span class="n">__arg8</span><span class="p">:</span> <span class="n">_T8</span><span class="p">,</span>
        <span class="n">__arg9</span><span class="p">:</span> <span class="n">_T9</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span>
    <span class="n">__method</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">_Ret</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_RemoteMethodNoArgs</span><span class="p">[</span><span class="n">_Ret</span><span class="p">]:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span>
    <span class="n">__method</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">_T0</span><span class="p">],</span> <span class="n">_Ret</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_RemoteMethod0</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">]:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span>
    <span class="n">__method</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">],</span> <span class="n">_Ret</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_RemoteMethod1</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">]:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span>
    <span class="n">__method</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">],</span> <span class="n">_Ret</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_RemoteMethod2</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">]:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span>
    <span class="n">__method</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">],</span> <span class="n">_Ret</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_RemoteMethod3</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">]:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span>
    <span class="n">__method</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">],</span> <span class="n">_Ret</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_RemoteMethod4</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">]:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span>
    <span class="n">__method</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">,</span> <span class="n">_T5</span><span class="p">],</span> <span class="n">_Ret</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_RemoteMethod5</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">,</span> <span class="n">_T5</span><span class="p">]:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span>
    <span class="n">__method</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">,</span> <span class="n">_T5</span><span class="p">,</span> <span class="n">_T6</span><span class="p">],</span> <span class="n">_Ret</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_RemoteMethod6</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">,</span> <span class="n">_T5</span><span class="p">,</span> <span class="n">_T6</span><span class="p">]:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span>
    <span class="n">__method</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">,</span> <span class="n">_T5</span><span class="p">,</span> <span class="n">_T6</span><span class="p">,</span> <span class="n">_T7</span><span class="p">],</span> <span class="n">_Ret</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_RemoteMethod7</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">,</span> <span class="n">_T5</span><span class="p">,</span> <span class="n">_T6</span><span class="p">,</span> <span class="n">_T7</span><span class="p">]:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span>
    <span class="n">__method</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">,</span> <span class="n">_T5</span><span class="p">,</span> <span class="n">_T6</span><span class="p">,</span> <span class="n">_T7</span><span class="p">,</span> <span class="n">_T8</span><span class="p">],</span> <span class="n">_Ret</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_RemoteMethod8</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">,</span> <span class="n">_T5</span><span class="p">,</span> <span class="n">_T6</span><span class="p">,</span> <span class="n">_T7</span><span class="p">,</span> <span class="n">_T8</span><span class="p">]:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span>
    <span class="n">__method</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">,</span> <span class="n">_T5</span><span class="p">,</span> <span class="n">_T6</span><span class="p">,</span> <span class="n">_T7</span><span class="p">,</span> <span class="n">_T8</span><span class="p">,</span> <span class="n">_T9</span><span class="p">],</span> <span class="n">_Ret</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_RemoteMethod9</span><span class="p">[</span><span class="n">_Ret</span><span class="p">,</span> <span class="n">_T0</span><span class="p">,</span> <span class="n">_T1</span><span class="p">,</span> <span class="n">_T2</span><span class="p">,</span> <span class="n">_T3</span><span class="p">,</span> <span class="n">_T4</span><span class="p">,</span> <span class="n">_T5</span><span class="p">,</span> <span class="n">_T6</span><span class="p">,</span> <span class="n">_T7</span><span class="p">,</span> <span class="n">_T8</span><span class="p">,</span> <span class="n">_T9</span><span class="p">]:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">num_returns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;streaming&quot;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">concurrency_group</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_task_retries</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">retry_exceptions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">_generator_backpressure_num_objects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">enable_task_events</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tensor_transport</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorTransportEnum</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">_P</span><span class="p">],</span> <span class="n">_Ret</span><span class="p">]],</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="o">...</span>


<div class="viewcode-block" id="method">
<a class="viewcode-back" href="../../ray.html#ray.method">[docs]</a>
<span class="nd">@PublicAPI</span>
<span class="nd">@client_mode_hook</span>
<span class="k">def</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Annotate an actor method.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        @ray.remote</span>
<span class="sd">        class Foo:</span>
<span class="sd">            @ray.method(num_returns=2)</span>
<span class="sd">            def bar(self):</span>
<span class="sd">                return 1, 2</span>

<span class="sd">        f = Foo.remote()</span>

<span class="sd">        _, _ = f.bar.remote()</span>

<span class="sd">    Args:</span>
<span class="sd">        num_returns: The number of object refs that should be returned by</span>
<span class="sd">            invocations of this actor method. The default value is 1 for a</span>
<span class="sd">            normal actor task and &quot;streaming&quot; for an actor generator task (a</span>
<span class="sd">            function that yields objects instead of returning them).</span>
<span class="sd">        max_task_retries: How many times to retry an actor task if the task</span>
<span class="sd">            fails due to a runtime error, e.g., the actor has died. The</span>
<span class="sd">            default value is 0. If set to -1, the system will retry the</span>
<span class="sd">            failed task until the task succeeds, or the actor has reached</span>
<span class="sd">            its max_restarts limit. If set to `n &gt; 0`, the system will retry</span>
<span class="sd">            the failed task up to n times, after which the task will throw a</span>
<span class="sd">            `RayActorError` exception upon :obj:`ray.get`.  Note that Python</span>
<span class="sd">            exceptions may trigger retries</span>
<span class="sd">            *only if* `retry_exceptions` is set for the method, in that case</span>
<span class="sd">            when `max_task_retries` runs out the task will rethrow the</span>
<span class="sd">            exception from the task. You can override this number with the</span>
<span class="sd">            method&#39;s `max_task_retries` option in `@ray.method` decorator or</span>
<span class="sd">            in `.option()`.</span>
<span class="sd">        retry_exceptions: Boolean of whether to retry all Python</span>
<span class="sd">            exceptions, or a list of allowlist exceptions to retry. The default</span>
<span class="sd">            value is False (only retry tasks upon system failures and if</span>
<span class="sd">            max_task_retries is set)</span>
<span class="sd">        concurrency_group: The name of the concurrency group</span>
<span class="sd">            to use for the actor method. By default, the actor is</span>
<span class="sd">            single-threaded and runs all actor tasks on the same thread.</span>
<span class="sd">            See :ref:`Defining Concurrency Groups &lt;defining-concurrency-groups&gt;`.</span>
<span class="sd">        tensor_transport: [Experimental] The tensor transport protocol to</span>
<span class="sd">            use for the actor method. The valid values are &quot;OBJECT_STORE&quot;</span>
<span class="sd">            (default), &quot;NCCL&quot;, or &quot;GLOO&quot; (case-insensitive). torch.Tensors</span>
<span class="sd">            returned by this task will be sent to other tasks using the</span>
<span class="sd">            specified transport. NCCL and GLOO transports require first creating</span>
<span class="sd">            a collective with the involved actors using</span>
<span class="sd">            `ray.experimental.collective.create_collective_group`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valid_kwargs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;num_returns&quot;</span><span class="p">,</span>
        <span class="s2">&quot;concurrency_group&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max_task_retries&quot;</span><span class="p">,</span>
        <span class="s2">&quot;retry_exceptions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_generator_backpressure_num_objects&quot;</span><span class="p">,</span>
        <span class="s2">&quot;enable_task_events&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tensor_transport&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">annotate_method</span><span class="p">(</span><span class="n">method</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">_P</span><span class="p">,</span> <span class="n">_Ret</span><span class="p">]):</span>
        <span class="k">if</span> <span class="s2">&quot;num_returns&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">method</span><span class="o">.</span><span class="n">__ray_num_returns__</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;num_returns&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;max_task_retries&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">method</span><span class="o">.</span><span class="n">__ray_max_task_retries__</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;max_task_retries&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;retry_exceptions&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">method</span><span class="o">.</span><span class="n">__ray_retry_exceptions__</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;retry_exceptions&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;concurrency_group&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">method</span><span class="o">.</span><span class="n">__ray_concurrency_group__</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;concurrency_group&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;_generator_backpressure_num_objects&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">method</span><span class="o">.</span><span class="n">__ray_generator_backpressure_num_objects__</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span>
                <span class="s2">&quot;_generator_backpressure_num_objects&quot;</span>
            <span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;enable_task_events&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;enable_task_events&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">method</span><span class="o">.</span><span class="n">__ray_enable_task_events__</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;enable_task_events&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;tensor_transport&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">method</span><span class="o">.</span><span class="n">__ray_tensor_transport__</span> <span class="o">=</span> <span class="n">TensorTransportEnum</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;tensor_transport&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">method</span>

    <span class="c1"># Check if decorator is called without parentheses (args[0] would be the function)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Called as @ray.method (without parentheses)</span>
        <span class="k">return</span> <span class="n">annotate_method</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Called as @ray.method() or @ray.method(options...)</span>
    <span class="n">error_string</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;The @ray.method decorator must be applied using no arguments or at &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;least one of the arguments in the list </span><span class="si">{</span><span class="n">valid_kwargs</span><span class="si">}</span><span class="s2">, for example &quot;</span>
        <span class="s2">&quot;&#39;@ray.method(num_returns=2)&#39;.&quot;</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">error_string</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">key_error_string</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unexpected keyword argument to @ray.method: &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39;. The &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;supported keyword arguments are </span><span class="si">{</span><span class="n">valid_kwargs</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">valid_kwargs</span><span class="p">,</span> <span class="n">key_error_string</span>

    <span class="k">return</span> <span class="n">annotate_method</span></div>



<span class="k">class</span><span class="w"> </span><span class="nc">_ActorMethodMetadata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A container for the metadata required to invoke an actor method.</span>

<span class="sd">    This class intentionally does *not* hold a reference to the `ActorHandle`, as that causes</span>
<span class="sd">    a circular reference that delays `ActorHandle` destruction until the Python GC runs.</span>

<span class="sd">    Instead, it can be used as a factory to lazily generate `ActorMethod` instances that can</span>
<span class="sd">    be used to submit actor tasks for this method.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_returns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;streaming&quot;</span><span class="p">]]],</span>
        <span class="n">max_task_retries</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">retry_exceptions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span>
        <span class="n">is_generator</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">generator_backpressure_num_objects</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">enable_task_events</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">decorator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">signature</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tensor_transport</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorTransportEnum</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize an _ActorMethodMetadata.</span>

<span class="sd">        Args:</span>
<span class="sd">            method_name: The name of the actor method.</span>
<span class="sd">            num_returns: The default number of return values that the method</span>
<span class="sd">                invocation should return. If None is given, it uses</span>
<span class="sd">                DEFAULT_ACTOR_METHOD_NUM_RETURN_VALS for a normal actor task</span>
<span class="sd">                and &quot;streaming&quot; for a generator task (when `is_generator` is True).</span>
<span class="sd">            max_task_retries: Number of retries on method failure.</span>
<span class="sd">            retry_exceptions: Boolean or list/tuple of exceptions to retry.</span>
<span class="sd">            is_generator: True if the method is a generator.</span>
<span class="sd">            generator_backpressure_num_objects: Generator-only config for backpressure.</span>
<span class="sd">            enable_task_events: True if task events are enabled for this method.</span>
<span class="sd">            decorator: Optional decorator for the method invocation.</span>
<span class="sd">            signature: The signature of the actor method.</span>
<span class="sd">            tensor_transport: The tensor transport protocol to use for the actor method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_method_name</span> <span class="o">=</span> <span class="n">method_name</span>

        <span class="c1"># Default case.</span>
        <span class="k">if</span> <span class="n">num_returns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_generator</span><span class="p">:</span>
                <span class="n">num_returns</span> <span class="o">=</span> <span class="s2">&quot;streaming&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">num_returns</span> <span class="o">=</span> <span class="n">ray_constants</span><span class="o">.</span><span class="n">DEFAULT_ACTOR_METHOD_NUM_RETURN_VALS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_returns</span> <span class="o">=</span> <span class="n">num_returns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_task_retries</span> <span class="o">=</span> <span class="n">max_task_retries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_retry_exceptions</span> <span class="o">=</span> <span class="n">retry_exceptions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_generator</span> <span class="o">=</span> <span class="n">is_generator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generator_backpressure_num_objects</span> <span class="o">=</span> <span class="n">generator_backpressure_num_objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable_task_events</span> <span class="o">=</span> <span class="n">enable_task_events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decorator</span> <span class="o">=</span> <span class="n">decorator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_signature</span> <span class="o">=</span> <span class="n">signature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_transport</span> <span class="o">=</span> <span class="n">tensor_transport</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actor_handle</span><span class="p">:</span> <span class="s2">&quot;ActorHandle&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ActorMethod&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Produce a bound ActorMethod that holds a strong reference to actor_handle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ActorMethod</span><span class="p">(</span>
            <span class="n">actor_handle</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_method_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_returns</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_max_task_retries</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_retry_exceptions</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_generator</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generator_backpressure_num_objects</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enable_task_events</span><span class="p">,</span>
            <span class="n">decorator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_decorator</span><span class="p">,</span>
            <span class="n">signature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_signature</span><span class="p">,</span>
            <span class="n">tensor_transport</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tensor_transport</span><span class="p">,</span>
        <span class="p">)</span>


<span class="c1"># Create objects to wrap method invocations. This is done so that we can</span>
<span class="c1"># invoke methods with actor.method.remote() instead of actor.method().</span>
<span class="nd">@PublicAPI</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ActorMethod</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class used to invoke an actor method.</span>

<span class="sd">    Note: This class should not be instantiated directly. Instead, it should</span>
<span class="sd">    only be used as a return value from the `@ray.method` decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">actor</span><span class="p">,</span>
        <span class="n">method_name</span><span class="p">,</span>
        <span class="n">num_returns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;streaming&quot;</span><span class="p">]]],</span>
        <span class="n">max_task_retries</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">retry_exceptions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span>
        <span class="n">is_generator</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">generator_backpressure_num_objects</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">enable_task_events</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">decorator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">signature</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tensor_transport</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorTransportEnum</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize an ActorMethod.</span>

<span class="sd">        Args:</span>
<span class="sd">            actor: The actor instance this method belongs to.</span>
<span class="sd">            method_name: The name of the actor method.</span>
<span class="sd">            num_returns: The default number of return values that the method</span>
<span class="sd">                invocation should return. If None is given, it uses</span>
<span class="sd">                DEFAULT_ACTOR_METHOD_NUM_RETURN_VALS for a normal actor task</span>
<span class="sd">                and &quot;streaming&quot; for a generator task (when `is_generator` is True).</span>
<span class="sd">            max_task_retries: Number of retries on method failure.</span>
<span class="sd">            retry_exceptions: Boolean of whether you want to retry all user-raised</span>
<span class="sd">                exceptions, or a list of allowlist exceptions to retry.</span>
<span class="sd">            is_generator: True if a given method is a Python generator.</span>
<span class="sd">            generator_backpressure_num_objects: Generator-only config.</span>
<span class="sd">                If a number of unconsumed objects reach this threshold,</span>
<span class="sd">                a actor task stop pausing.</span>
<span class="sd">            enable_task_events: True if task events is enabled, i.e., task events from</span>
<span class="sd">                the actor should be reported. Defaults to True.</span>
<span class="sd">            decorator: An optional decorator that should be applied to the actor</span>
<span class="sd">                method invocation.</span>
<span class="sd">            signature: The signature of the actor method. It is None only when cross</span>
<span class="sd">                language feature is used.</span>
<span class="sd">            tensor_transport: The tensor transport protocol to use for the actor method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_actor</span> <span class="o">=</span> <span class="n">actor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_method_name</span> <span class="o">=</span> <span class="n">method_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_returns</span> <span class="o">=</span> <span class="n">num_returns</span>

        <span class="c1"># Default case.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_returns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_generator</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num_returns</span> <span class="o">=</span> <span class="s2">&quot;streaming&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num_returns</span> <span class="o">=</span> <span class="n">ray_constants</span><span class="o">.</span><span class="n">DEFAULT_ACTOR_METHOD_NUM_RETURN_VALS</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_max_task_retries</span> <span class="o">=</span> <span class="n">max_task_retries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_retry_exceptions</span> <span class="o">=</span> <span class="n">retry_exceptions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_generator</span> <span class="o">=</span> <span class="n">is_generator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generator_backpressure_num_objects</span> <span class="o">=</span> <span class="n">generator_backpressure_num_objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable_task_events</span> <span class="o">=</span> <span class="n">enable_task_events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_signature</span> <span class="o">=</span> <span class="n">signature</span>
        <span class="c1"># This is a decorator that is used to wrap the function invocation (as</span>
        <span class="c1"># opposed to the function execution). The decorator must return a</span>
        <span class="c1"># function that takes in two arguments (&quot;args&quot; and &quot;kwargs&quot;). In most</span>
        <span class="c1"># cases, it should call the function that was passed into the decorator</span>
        <span class="c1"># and return the resulting ObjectRefs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decorator</span> <span class="o">=</span> <span class="n">decorator</span>

        <span class="c1"># If the task call doesn&#39;t specify a tensor transport option, use `_tensor_transport`</span>
        <span class="c1"># as the default transport for this actor method.</span>
        <span class="k">if</span> <span class="n">tensor_transport</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tensor_transport</span> <span class="o">=</span> <span class="n">TensorTransportEnum</span><span class="o">.</span><span class="n">OBJECT_STORE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_transport</span> <span class="o">=</span> <span class="n">tensor_transport</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;Actor methods cannot be called directly. Instead &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;of running &#39;object.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_method_name</span><span class="si">}</span><span class="s2">()&#39;, try &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;object.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_method_name</span><span class="si">}</span><span class="s2">.remote()&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="nd">@DeveloperAPI</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bind arguments to the actor method for Ray DAG building.</span>

<span class="sd">        This method generates and returns an intermediate representation (IR)</span>
<span class="sd">        node that indicates the actor method will be called with the given</span>
<span class="sd">        arguments at execution time.</span>

<span class="sd">        This method is used in both :ref:`Ray DAG &lt;ray-dag-guide&gt;` and</span>
<span class="sd">        :ref:`Ray Compiled Graph &lt;ray-compiled-graph&gt;` for building a DAG.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bind</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convenience method for executing an actor method call with options.</span>

<span class="sd">        Same arguments as func._remote(), but returns a wrapped function</span>
<span class="sd">        that a non-underscore .remote() can be called on.</span>

<span class="sd">        Examples:</span>
<span class="sd">            # The following two calls are equivalent.</span>
<span class="sd">            &gt;&gt;&gt; actor.my_method._remote(args=[x, y], name=&quot;foo&quot;, num_returns=2)</span>
<span class="sd">            &gt;&gt;&gt; actor.my_method.options(name=&quot;foo&quot;, num_returns=2).remote(x, y)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">func_cls</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">class</span><span class="w"> </span><span class="nc">FuncWrapper</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">remote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">func_cls</span><span class="o">.</span><span class="n">_remote</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

            <span class="nd">@DeveloperAPI</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">func_cls</span><span class="o">.</span><span class="n">_bind</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">FuncWrapper</span><span class="p">()</span>

    <span class="nd">@wrap_auto_init</span>
    <span class="nd">@_tracing_actor_method_invocation</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_bind</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">num_returns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">concurrency_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">_generator_backpressure_num_objects</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;ray.dag.ClassMethodNode&quot;</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;ray.dag.ClassMethodNode&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">ray.dag.class_node</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
            <span class="n">BIND_INDEX_KEY</span><span class="p">,</span>
            <span class="n">IS_CLASS_METHOD_OUTPUT_KEY</span><span class="p">,</span>
            <span class="n">PARENT_CLASS_NODE_KEY</span><span class="p">,</span>
            <span class="n">PREV_CLASS_METHOD_CALL_KEY</span><span class="p">,</span>
            <span class="n">ClassMethodNode</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># TODO(sang): unify option passing</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;num_returns&quot;</span><span class="p">:</span> <span class="n">num_returns</span><span class="p">,</span>
            <span class="s2">&quot;concurrency_group&quot;</span><span class="p">:</span> <span class="n">concurrency_group</span><span class="p">,</span>
            <span class="s2">&quot;_generator_backpressure_num_objects&quot;</span><span class="p">:</span> <span class="n">_generator_backpressure_num_objects</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actor</span>
        <span class="k">if</span> <span class="n">actor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Ref is GC&#39;ed. It happens when the actor handle is GC&#39;ed</span>
            <span class="c1"># when bind is called.</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Lost reference to actor&quot;</span><span class="p">)</span>

        <span class="n">other_args_to_resolve</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">PARENT_CLASS_NODE_KEY</span><span class="p">:</span> <span class="n">actor</span><span class="p">,</span>
            <span class="n">PREV_CLASS_METHOD_CALL_KEY</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">BIND_INDEX_KEY</span><span class="p">:</span> <span class="n">actor</span><span class="o">.</span><span class="n">_ray_dag_bind_index</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">actor</span><span class="o">.</span><span class="n">_ray_dag_bind_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_signature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">),</span> <span class="s2">&quot;self._signature should be set for .bind API.&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">signature</span><span class="o">.</span><span class="n">validate_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_signature</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">signature_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_signature</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">signature_copy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">signature_copy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;_ray_trace_ctx&quot;</span><span class="p">:</span>
                <span class="c1"># Remove the trace context arg for readability.</span>
                <span class="n">signature_copy</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">signature_copy</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Signature</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">signature_copy</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">. The function `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_method_name</span><span class="si">}</span><span class="s2">` has a signature &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">signature_copy</span><span class="si">}</span><span class="s2">`, but the given arguments to `bind` doesn&#39;t &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;match. args: </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">. kwargs: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>

        <span class="n">node</span> <span class="o">=</span> <span class="n">ClassMethodNode</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_method_name</span><span class="p">,</span>
            <span class="n">args</span><span class="p">,</span>
            <span class="n">kwargs</span><span class="p">,</span>
            <span class="n">options</span><span class="p">,</span>
            <span class="n">other_args_to_resolve</span><span class="o">=</span><span class="n">other_args_to_resolve</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">num_returns</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">output_nodes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ClassMethodNode</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">num_returns</span><span class="p">):</span>
                <span class="n">output_node</span> <span class="o">=</span> <span class="n">ClassMethodNode</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;return_idx_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span>
                    <span class="nb">dict</span><span class="p">(),</span>
                    <span class="nb">dict</span><span class="p">(),</span>
                    <span class="p">{</span><span class="n">IS_CLASS_METHOD_OUTPUT_KEY</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="n">PARENT_CLASS_NODE_KEY</span><span class="p">:</span> <span class="n">actor</span><span class="p">},</span>
                <span class="p">)</span>
                <span class="n">output_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_node</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">output_nodes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span>

    <span class="nd">@wrap_auto_init</span>
    <span class="nd">@_tracing_actor_method_invocation</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_remote</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">num_returns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">max_task_retries</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">retry_exceptions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">concurrency_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">_generator_backpressure_num_objects</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">enable_task_events</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tensor_transport_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">num_returns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num_returns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_returns</span>
        <span class="k">if</span> <span class="n">max_task_retries</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_task_retries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_task_retries</span>
        <span class="k">if</span> <span class="n">max_task_retries</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_task_retries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">retry_exceptions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">retry_exceptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retry_exceptions</span>
        <span class="k">if</span> <span class="n">enable_task_events</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">enable_task_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enable_task_events</span>
        <span class="k">if</span> <span class="n">_generator_backpressure_num_objects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_generator_backpressure_num_objects</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_generator_backpressure_num_objects</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">tensor_transport_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tensor_transport</span> <span class="o">=</span> <span class="n">TensorTransportEnum</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="n">tensor_transport_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tensor_transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tensor_transport</span>
        <span class="k">if</span> <span class="n">tensor_transport</span> <span class="o">!=</span> <span class="n">TensorTransportEnum</span><span class="o">.</span><span class="n">OBJECT_STORE</span> <span class="ow">and</span> <span class="n">num_returns</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Currently, methods with tensor_transport=</span><span class="si">{</span><span class="n">tensor_transport</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> only support 1 return value. &quot;</span>
                <span class="s2">&quot;Please make sure the actor method is decorated with `@ray.method(num_returns=1)` (the default).&quot;</span>
            <span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">args</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">invocation</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="n">dst_actor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actor</span>
            <span class="k">if</span> <span class="n">dst_actor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># See https://github.com/ray-project/ray/issues/6265 for more details.</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Lost reference to actor. Actor handles must be stored as variables, e.g. `actor = MyActor.remote()` before calling methods.&quot;</span>
                <span class="p">)</span>

            <span class="n">gpu_object_manager</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">_private</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">global_worker</span><span class="o">.</span><span class="n">gpu_object_manager</span>
            <span class="n">gpu_object_manager</span><span class="o">.</span><span class="n">trigger_out_of_band_tensor_transfer</span><span class="p">(</span><span class="n">dst_actor</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">dst_actor</span><span class="o">.</span><span class="n">_actor_method_call</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_method_name</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
                <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">num_returns</span><span class="o">=</span><span class="n">num_returns</span><span class="p">,</span>
                <span class="n">max_task_retries</span><span class="o">=</span><span class="n">max_task_retries</span><span class="p">,</span>
                <span class="n">retry_exceptions</span><span class="o">=</span><span class="n">retry_exceptions</span><span class="p">,</span>
                <span class="n">concurrency_group_name</span><span class="o">=</span><span class="n">concurrency_group</span><span class="p">,</span>
                <span class="n">generator_backpressure_num_objects</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">_generator_backpressure_num_objects</span>
                <span class="p">),</span>
                <span class="n">enable_task_events</span><span class="o">=</span><span class="n">enable_task_events</span><span class="p">,</span>
                <span class="n">tensor_transport</span><span class="o">=</span><span class="n">tensor_transport</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Apply the decorator if there is one.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decorator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">invocation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decorator</span><span class="p">(</span><span class="n">invocation</span><span class="p">)</span>

        <span class="n">obj_ref</span> <span class="o">=</span> <span class="n">invocation</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tensor_transport</span> <span class="o">!=</span> <span class="n">TensorTransportEnum</span><span class="o">.</span><span class="n">OBJECT_STORE</span><span class="p">:</span>
            <span class="n">gpu_object_manager</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">_private</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">global_worker</span><span class="o">.</span><span class="n">gpu_object_manager</span>
            <span class="n">gpu_object_manager</span><span class="o">.</span><span class="n">add_gpu_object_ref</span><span class="p">(</span>
                <span class="n">obj_ref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actor</span><span class="p">,</span> <span class="n">tensor_transport</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">obj_ref</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;actor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actor</span><span class="p">,</span>
            <span class="s2">&quot;method_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method_name</span><span class="p">,</span>
            <span class="s2">&quot;num_returns&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_returns</span><span class="p">,</span>
            <span class="s2">&quot;max_task_retries&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_task_retries</span><span class="p">,</span>
            <span class="s2">&quot;retry_exceptions&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retry_exceptions</span><span class="p">,</span>
            <span class="s2">&quot;decorator&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decorator</span><span class="p">,</span>
            <span class="s2">&quot;is_generator&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_generator</span><span class="p">,</span>
            <span class="s2">&quot;generator_backpressure_num_objects&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generator_backpressure_num_objects</span><span class="p">,</span>  <span class="c1"># noqa</span>
            <span class="s2">&quot;enable_task_events&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enable_task_events</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;actor&quot;</span><span class="p">],</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;method_name&quot;</span><span class="p">],</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;num_returns&quot;</span><span class="p">],</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;max_task_retries&quot;</span><span class="p">],</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;retry_exceptions&quot;</span><span class="p">],</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;is_generator&quot;</span><span class="p">],</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;generator_backpressure_num_objects&quot;</span><span class="p">],</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;enable_task_events&quot;</span><span class="p">],</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;decorator&quot;</span><span class="p">],</span>
        <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_ActorClassMethodMetadata</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Metadata for all methods in an actor class. This data can be cached.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        methods: The actor methods.</span>
<span class="sd">        decorators: Optional decorators that should be applied to the</span>
<span class="sd">            method invocation function before invoking the actor methods. These</span>
<span class="sd">            can be set by attaching the attribute</span>
<span class="sd">            &quot;__ray_invocation_decorator__&quot; to the actor method.</span>
<span class="sd">        signatures: The signatures of the methods.</span>
<span class="sd">        num_returns: The default number of return values for</span>
<span class="sd">            each actor method.</span>
<span class="sd">        max_task_retries: Number of retries on method failure.</span>
<span class="sd">        retry_exceptions: Boolean of whether you want to retry all user-raised</span>
<span class="sd">            exceptions, or a list of allowlist exceptions to retry, for each method.</span>
<span class="sd">        enable_task_events: True if tracing is enabled, i.e., task events from</span>
<span class="sd">            the actor should be reported. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_cache</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># This cache will be cleared in ray._private.worker.disconnect()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2"> can not be constructed directly, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;instead of running &#39;</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">()&#39;, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;try &#39;</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">.create()&#39;&quot;</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">reset_cache</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">modified_class</span><span class="p">,</span> <span class="n">actor_creation_function_descriptor</span><span class="p">):</span>
        <span class="c1"># Try to create an instance from cache.</span>
        <span class="n">cached_meta</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">actor_creation_function_descriptor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached_meta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cached_meta</span>

        <span class="c1"># Create an instance without __init__ called.</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="n">actor_methods</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">modified_class</span><span class="p">,</span> <span class="n">is_function_or_method</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">methods</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">actor_methods</span><span class="p">)</span>

        <span class="c1"># Extract the signatures of each of the methods. This will be used</span>
        <span class="c1"># to catch some errors if the methods are called with inappropriate</span>
        <span class="c1"># arguments.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decorators</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signatures</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_returns</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_task_retries</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retry_exceptions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_is_generator</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_task_events</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generator_backpressure_num_objects</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">concurrency_group_for_methods</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name_to_tensor_transport</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TensorTransportEnum</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">actor_methods</span><span class="p">:</span>
            <span class="c1"># Whether or not this method requires binding of its first</span>
            <span class="c1"># argument. For class and static methods, we do not want to bind</span>
            <span class="c1"># the first argument, but we do for instance methods</span>
            <span class="n">method</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
            <span class="n">is_bound</span> <span class="o">=</span> <span class="n">is_class_method</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_static_method</span><span class="p">(</span>
                <span class="n">modified_class</span><span class="p">,</span> <span class="n">method_name</span>
            <span class="p">)</span>

            <span class="c1"># Print a warning message if the method signature is not</span>
            <span class="c1"># supported. We don&#39;t raise an exception because if the actor</span>
            <span class="c1"># inherits from a class that has a method whose signature we</span>
            <span class="c1"># don&#39;t support, there may not be much the user can do about it.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signatures</span><span class="p">[</span><span class="n">method_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="n">extract_signature</span><span class="p">(</span>
                <span class="n">method</span><span class="p">,</span> <span class="n">ignore_first</span><span class="o">=</span><span class="ow">not</span> <span class="n">is_bound</span>
            <span class="p">)</span>
            <span class="c1"># Set the default number of return values for this method.</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;__ray_num_returns__&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">num_returns</span><span class="p">[</span><span class="n">method_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">__ray_num_returns__</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">num_returns</span><span class="p">[</span><span class="n">method_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Only contains entries from `@ray.method(max_task_retries=...)`</span>
            <span class="c1"># Ray may not populate the others with max_task_retries here because you may</span>
            <span class="c1"># have set in `actor.method.options(max_task_retries=...)`. So Ray always</span>
            <span class="c1"># stores max_task_retries both from the method and from the actor, and</span>
            <span class="c1"># favors the former.</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;__ray_max_task_retries__&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_task_retries</span><span class="p">[</span><span class="n">method_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">__ray_max_task_retries__</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;__ray_retry_exceptions__&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">retry_exceptions</span><span class="p">[</span><span class="n">method_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">__ray_retry_exceptions__</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;__ray_invocation_decorator__&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">decorators</span><span class="p">[</span><span class="n">method_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">__ray_invocation_decorator__</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;__ray_concurrency_group__&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">concurrency_group_for_methods</span><span class="p">[</span>
                    <span class="n">method_name</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">__ray_concurrency_group__</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;__ray_enable_task_events__&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enable_task_events</span><span class="p">[</span><span class="n">method_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">__ray_enable_task_events__</span>

            <span class="n">is_generator</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isgeneratorfunction</span><span class="p">(</span>
                <span class="n">method</span>
            <span class="p">)</span> <span class="ow">or</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isasyncgenfunction</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_is_generator</span><span class="p">[</span><span class="n">method_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_generator</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;__ray_generator_backpressure_num_objects__&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generator_backpressure_num_objects</span><span class="p">[</span>
                    <span class="n">method_name</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">__ray_generator_backpressure_num_objects__</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="s2">&quot;__ray_tensor_transport__&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">method_name_to_tensor_transport</span><span class="p">[</span>
                    <span class="n">method_name</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">__ray_tensor_transport__</span>

        <span class="c1"># Update cache.</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">actor_creation_function_descriptor</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="bp">self</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_ActorClassMetadata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Metadata for an actor class.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        language: The actor language, e.g. Python, Java.</span>
<span class="sd">        modified_class: The original class that was decorated (with some</span>
<span class="sd">            additional methods added like __ray_terminate__).</span>
<span class="sd">        actor_creation_function_descriptor: The function descriptor for</span>
<span class="sd">            the actor creation task.</span>
<span class="sd">        class_id: The ID of this actor class.</span>
<span class="sd">        class_name: The name of this class.</span>
<span class="sd">        num_cpus: The default number of CPUs required by the actor creation</span>
<span class="sd">            task.</span>
<span class="sd">        num_gpus: The default number of GPUs required by the actor creation</span>
<span class="sd">            task.</span>
<span class="sd">        memory: The heap memory quota for this actor.</span>
<span class="sd">        resources: The default resources required by the actor creation task.</span>
<span class="sd">        label_selector: The labels required for the node on which this actor</span>
<span class="sd">            can be scheduled on. The label selector consist of key-value pairs, where the keys</span>
<span class="sd">            are label names and the value are expressions consisting of an operator with label values or just a value to indicate equality.</span>
<span class="sd">        accelerator_type: The specified type of accelerator required for the</span>
<span class="sd">            node on which this actor runs.</span>
<span class="sd">            See :ref:`accelerator types &lt;accelerator_types&gt;`.</span>
<span class="sd">        runtime_env: The runtime environment for this actor.</span>
<span class="sd">        scheduling_strategy: Strategy about how to schedule this actor.</span>
<span class="sd">        last_export_cluster_and_job: A pair of the last exported cluster</span>
<span class="sd">            and job to help us to know whether this function was exported.</span>
<span class="sd">            This is an imperfect mechanism used to determine if we need to</span>
<span class="sd">            export the remote function again. It is imperfect in the sense that</span>
<span class="sd">            the actor class definition could be exported multiple times by</span>
<span class="sd">            different workers.</span>
<span class="sd">        method_meta: The actor method metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">language</span><span class="p">,</span>
        <span class="n">modified_class</span><span class="p">,</span>
        <span class="n">actor_creation_function_descriptor</span><span class="p">,</span>
        <span class="n">class_id</span><span class="p">,</span>
        <span class="n">max_restarts</span><span class="p">,</span>
        <span class="n">max_task_retries</span><span class="p">,</span>
        <span class="n">num_cpus</span><span class="p">,</span>
        <span class="n">num_gpus</span><span class="p">,</span>
        <span class="n">memory</span><span class="p">,</span>
        <span class="n">object_store_memory</span><span class="p">,</span>
        <span class="n">resources</span><span class="p">,</span>
        <span class="n">label_selector</span><span class="p">,</span>
        <span class="n">accelerator_type</span><span class="p">,</span>
        <span class="n">runtime_env</span><span class="p">,</span>
        <span class="n">concurrency_groups</span><span class="p">,</span>
        <span class="n">scheduling_strategy</span><span class="p">:</span> <span class="n">SchedulingStrategyT</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modified_class</span> <span class="o">=</span> <span class="n">modified_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actor_creation_function_descriptor</span> <span class="o">=</span> <span class="n">actor_creation_function_descriptor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_name</span> <span class="o">=</span> <span class="n">actor_creation_function_descriptor</span><span class="o">.</span><span class="n">class_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_cross_language</span> <span class="o">=</span> <span class="n">language</span> <span class="o">!=</span> <span class="n">Language</span><span class="o">.</span><span class="n">PYTHON</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_id</span> <span class="o">=</span> <span class="n">class_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_restarts</span> <span class="o">=</span> <span class="n">max_restarts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_task_retries</span> <span class="o">=</span> <span class="n">max_task_retries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cpus</span> <span class="o">=</span> <span class="n">num_cpus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_gpus</span> <span class="o">=</span> <span class="n">num_gpus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="n">memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object_store_memory</span> <span class="o">=</span> <span class="n">object_store_memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">resources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_selector</span> <span class="o">=</span> <span class="n">label_selector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accelerator_type</span> <span class="o">=</span> <span class="n">accelerator_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runtime_env</span> <span class="o">=</span> <span class="n">runtime_env</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">concurrency_groups</span> <span class="o">=</span> <span class="n">concurrency_groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheduling_strategy</span> <span class="o">=</span> <span class="n">scheduling_strategy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_export_cluster_and_job</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_meta</span> <span class="o">=</span> <span class="n">_ActorClassMethodMetadata</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">modified_class</span><span class="p">,</span> <span class="n">actor_creation_function_descriptor</span>
        <span class="p">)</span>


<span class="nd">@PublicAPI</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ActorClassInheritanceException</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_process_option_dict</span><span class="p">(</span><span class="n">actor_options</span><span class="p">):</span>
    <span class="n">_filled_options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">arg_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">_ActorClassMetadata</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ray_option_utils</span><span class="o">.</span><span class="n">actor_options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">arg_names</span><span class="p">:</span>
            <span class="n">_filled_options</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">actor_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">default_value</span><span class="p">)</span>
    <span class="n">_filled_options</span><span class="p">[</span><span class="s2">&quot;runtime_env&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_runtime_env_for_task_or_actor</span><span class="p">(</span>
        <span class="n">_filled_options</span><span class="p">[</span><span class="s2">&quot;runtime_env&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">_filled_options</span>


<span class="nd">@PublicAPI</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ActorClass</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An actor class.</span>

<span class="sd">    This is a decorated class. It can be used to create actors.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        __ray_metadata__: Contains metadata for the actor.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prevents users from directly inheriting from an ActorClass.</span>

<span class="sd">        This will be called when a class is defined with an ActorClass object</span>
<span class="sd">        as one of its base classes. To intentionally construct an ActorClass,</span>
<span class="sd">        use the &#39;_ray_from_modified_class&#39; classmethod.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ActorClassInheritanceException: When ActorClass is inherited.</span>
<span class="sd">            AssertionError: If ActorClassInheritanceException is not raised i.e.,</span>
<span class="sd">                            conditions for raising it are not met in any</span>
<span class="sd">                            iteration of the loop.</span>
<span class="sd">            TypeError: In all other cases.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">ActorClass</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ActorClassInheritanceException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Attempted to define subclass &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; of actor &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;class &#39;</span><span class="si">{</span><span class="n">base</span><span class="o">.</span><span class="n">__ray_metadata__</span><span class="o">.</span><span class="n">class_name</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                    <span class="s2">&quot;Inheriting from actor classes is &quot;</span>
                    <span class="s2">&quot;not currently supported. You can instead &quot;</span>
                    <span class="s2">&quot;inherit from a non-actor base class and make &quot;</span>
                    <span class="s2">&quot;the derived class an actor class (with &quot;</span>
                    <span class="s2">&quot;@ray.remote).&quot;</span>
                <span class="p">)</span>

        <span class="c1"># This shouldn&#39;t be reached because one of the base classes must be</span>
        <span class="c1"># an actor class if this was meant to be subclassed.</span>
        <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;ActorClass.__init__ should not be called. Please use &quot;</span>
            <span class="s2">&quot;the @ray.remote decorator instead.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prevents users from directly instantiating an ActorClass.</span>

<span class="sd">        This will be called instead of __init__ when &#39;ActorClass()&#39; is executed</span>
<span class="sd">        because an is an object rather than a metaobject. To properly</span>
<span class="sd">        instantiated a remote actor, use &#39;ActorClass.remote()&#39;.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: Always.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;Actors cannot be instantiated directly. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Instead of &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__ray_metadata__</span><span class="o">.</span><span class="n">class_name</span><span class="si">}</span><span class="s2">()&#39;, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;use &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__ray_metadata__</span><span class="o">.</span><span class="n">class_name</span><span class="si">}</span><span class="s2">.remote()&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_ray_from_modified_class</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">modified_class</span><span class="p">,</span>
        <span class="n">class_id</span><span class="p">,</span>
        <span class="n">actor_options</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;remote&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_remote&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_ray_from_modified_class&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_ray_from_function_descriptor&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">modified_class</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Creating an actor from class &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">modified_class</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> overwrites &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;attribute </span><span class="si">{</span><span class="n">attribute</span><span class="si">}</span><span class="s2"> of that class&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Make sure the actor class we are constructing inherits from the</span>
        <span class="c1"># original class so it retains all class properties.</span>
        <span class="k">class</span><span class="w"> </span><span class="nc">DerivedActorClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">modified_class</span><span class="p">):</span>
            <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># Delegate call to modified_class.__init__ only</span>
                    <span class="c1"># if the exception raised by cls.__init__ is</span>
                    <span class="c1"># TypeError and not ActorClassInheritanceException(TypeError).</span>
                    <span class="c1"># In all other cases proceed with raise e.</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
                        <span class="n">e</span><span class="p">,</span> <span class="n">ActorClassInheritanceException</span>
                    <span class="p">):</span>
                        <span class="n">modified_class</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">e</span>

        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ActorClass(</span><span class="si">{</span><span class="n">modified_class</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="n">DerivedActorClass</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">=</span> <span class="n">modified_class</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">DerivedActorClass</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">DerivedActorClass</span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c1"># Construct the base object.</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">DerivedActorClass</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">DerivedActorClass</span><span class="p">)</span>
        <span class="c1"># Actor creation function descriptor.</span>
        <span class="n">actor_creation_function_descriptor</span> <span class="o">=</span> <span class="n">PythonFunctionDescriptor</span><span class="o">.</span><span class="n">from_class</span><span class="p">(</span>
            <span class="n">modified_class</span><span class="o">.</span><span class="n">__ray_actor_class__</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__ray_metadata__</span> <span class="o">=</span> <span class="n">_ActorClassMetadata</span><span class="p">(</span>
            <span class="n">Language</span><span class="o">.</span><span class="n">PYTHON</span><span class="p">,</span>
            <span class="n">modified_class</span><span class="p">,</span>
            <span class="n">actor_creation_function_descriptor</span><span class="p">,</span>
            <span class="n">class_id</span><span class="p">,</span>
            <span class="o">**</span><span class="n">_process_option_dict</span><span class="p">(</span><span class="n">actor_options</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_options</span> <span class="o">=</span> <span class="n">actor_options</span>
        <span class="k">if</span> <span class="s2">&quot;runtime_env&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_options</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_default_options</span><span class="p">[</span><span class="s2">&quot;runtime_env&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ray_metadata__</span><span class="o">.</span><span class="n">runtime_env</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_ray_from_function_descriptor</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">language</span><span class="p">,</span>
        <span class="n">actor_creation_function_descriptor</span><span class="p">,</span>
        <span class="n">actor_options</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">ActorClass</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">ActorClass</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ray_metadata__</span> <span class="o">=</span> <span class="n">_ActorClassMetadata</span><span class="p">(</span>
            <span class="n">language</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">actor_creation_function_descriptor</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">_process_option_dict</span><span class="p">(</span><span class="n">actor_options</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_options</span> <span class="o">=</span> <span class="n">actor_options</span>
        <span class="k">if</span> <span class="s2">&quot;runtime_env&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_options</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_default_options</span><span class="p">[</span><span class="s2">&quot;runtime_env&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ray_metadata__</span><span class="o">.</span><span class="n">runtime_env</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ActorProxy</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an actor.</span>

<span class="sd">        Args:</span>
<span class="sd">            args: These arguments are forwarded directly to the actor</span>
<span class="sd">                constructor.</span>
<span class="sd">            kwargs: These arguments are forwarded directly to the actor</span>
<span class="sd">                constructor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A handle to the newly created actor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">actor_options</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configures and overrides the actor instantiation parameters.</span>

<span class="sd">        The arguments are the same as those that can be passed</span>
<span class="sd">        to :obj:`ray.remote`.</span>

<span class="sd">        Args:</span>
<span class="sd">            num_cpus: The quantity of CPU cores to reserve</span>
<span class="sd">                for this task or for the lifetime of the actor.</span>
<span class="sd">            num_gpus: The quantity of GPUs to reserve</span>
<span class="sd">                for this task or for the lifetime of the actor.</span>
<span class="sd">            resources (Dict[str, float]): The quantity of various custom resources</span>
<span class="sd">                to reserve for this task or for the lifetime of the actor.</span>
<span class="sd">                This is a dictionary mapping strings (resource names) to floats.</span>
<span class="sd">            label_selector (Dict[str, str]): If specified, requires that the actor run</span>
<span class="sd">                on a node which meets the specified label conditions (equals, in, not in, etc.).</span>
<span class="sd">            accelerator_type: If specified, requires that the task or actor run</span>
<span class="sd">                on a node with the specified type of accelerator.</span>
<span class="sd">                See :ref:`accelerator types &lt;accelerator_types&gt;`.</span>
<span class="sd">            memory: The heap memory request in bytes for this task/actor,</span>
<span class="sd">                rounded down to the nearest integer.</span>
<span class="sd">            object_store_memory: The object store memory request for actors only.</span>
<span class="sd">            max_restarts: This specifies the maximum</span>
<span class="sd">                number of times that the actor should be restarted when it dies</span>
<span class="sd">                unexpectedly. The minimum valid value is 0 (default),</span>
<span class="sd">                which indicates that the actor doesn&#39;t need to be restarted.</span>
<span class="sd">                A value of -1 indicates that an actor should be restarted</span>
<span class="sd">                indefinitely.</span>
<span class="sd">            max_task_retries: How many times to retry an actor task if the task</span>
<span class="sd">                fails due to a runtime error, e.g., the actor has died. The</span>
<span class="sd">                default value is 0. If set to -1, the system will retry the</span>
<span class="sd">                failed task until the task succeeds, or the actor has reached</span>
<span class="sd">                its max_restarts limit. If set to `n &gt; 0`, the system will retry</span>
<span class="sd">                the failed task up to n times, after which the task will throw a</span>
<span class="sd">                `RayActorError` exception upon :obj:`ray.get`.  Note that Python</span>
<span class="sd">                exceptions may trigger retries</span>
<span class="sd">                *only if* `retry_exceptions` is set for the method, in that case</span>
<span class="sd">                when `max_task_retries` runs out the task will rethrow the</span>
<span class="sd">                exception from the task. You can override this number with the</span>
<span class="sd">                method&#39;s `max_task_retries` option in `@ray.method` decorator or</span>
<span class="sd">                in `.option()`.</span>
<span class="sd">            max_pending_calls: Set the max number of pending calls</span>
<span class="sd">                allowed on the actor handle. When this value is exceeded,</span>
<span class="sd">                PendingCallsLimitExceeded will be raised for further tasks.</span>
<span class="sd">                Note that this limit is counted per handle. -1 means that the</span>
<span class="sd">                number of pending calls is unlimited.</span>
<span class="sd">            max_concurrency: The max number of concurrent calls to allow for</span>
<span class="sd">                this actor. This only works with direct actor calls. The max</span>
<span class="sd">                concurrency defaults to 1 for threaded execution, and 1000 for</span>
<span class="sd">                asyncio execution. Note that the execution order is not</span>
<span class="sd">                guaranteed when max_concurrency &gt; 1.</span>
<span class="sd">            name: The globally unique name for the actor, which can be used</span>
<span class="sd">                to retrieve the actor via ray.get_actor(name) as long as the</span>
<span class="sd">                actor is still alive.</span>
<span class="sd">            namespace: Override the namespace to use for the actor. By default,</span>
<span class="sd">                actors are created in an anonymous namespace. The actor can</span>
<span class="sd">                be retrieved via ray.get_actor(name=name, namespace=namespace).</span>
<span class="sd">            lifetime: Either `None`, which defaults to the actor will fate</span>
<span class="sd">                share with its creator and will be deleted once its refcount</span>
<span class="sd">                drops to zero, or &quot;detached&quot;, which means the actor will live</span>
<span class="sd">                as a global object independent of the creator.</span>
<span class="sd">            runtime_env (Dict[str, Any]): Specifies the runtime environment for</span>
<span class="sd">                this actor or task and its children. See</span>
<span class="sd">                :ref:`runtime-environments` for detailed documentation.</span>
<span class="sd">            scheduling_strategy: Strategy about how to</span>
<span class="sd">                schedule a remote function or actor. Possible values are</span>
<span class="sd">                None: ray will figure out the scheduling strategy to use, it</span>
<span class="sd">                will either be the PlacementGroupSchedulingStrategy using parent&#39;s</span>
<span class="sd">                placement group if parent has one and has</span>
<span class="sd">                placement_group_capture_child_tasks set to true,</span>
<span class="sd">                or &quot;DEFAULT&quot;;</span>
<span class="sd">                &quot;DEFAULT&quot;: default hybrid scheduling;</span>
<span class="sd">                &quot;SPREAD&quot;: best effort spread scheduling;</span>
<span class="sd">                `PlacementGroupSchedulingStrategy`:</span>
<span class="sd">                placement group based scheduling;</span>
<span class="sd">                `NodeAffinitySchedulingStrategy`:</span>
<span class="sd">                node id based affinity scheduling.</span>
<span class="sd">            _metadata: Extended options for Ray libraries. For example,</span>
<span class="sd">                _metadata={&quot;workflows.io/options&quot;: &lt;workflow options&gt;} for</span>
<span class="sd">                Ray workflows.</span>
<span class="sd">            enable_task_events: True if tracing is enabled, i.e., task events from</span>
<span class="sd">                the actor should be reported. Defaults to True.</span>

<span class="sd">        Examples:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            @ray.remote(num_cpus=2, resources={&quot;CustomResource&quot;: 1})</span>
<span class="sd">            class Foo:</span>
<span class="sd">                def method(self):</span>
<span class="sd">                    return 1</span>
<span class="sd">            # Class Bar will require 1 cpu instead of 2.</span>
<span class="sd">            # It will also require no custom resources.</span>
<span class="sd">            Bar = Foo.options(num_cpus=1, resources=None)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">actor_cls</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c1"># override original options</span>
        <span class="n">default_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_options</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># &quot;concurrency_groups&quot; could not be used in &quot;.options()&quot;,</span>
        <span class="c1"># we should remove it before merging options from &#39;@ray.remote&#39;.</span>
        <span class="n">default_options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;concurrency_groups&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">updated_options</span> <span class="o">=</span> <span class="n">ray_option_utils</span><span class="o">.</span><span class="n">update_options</span><span class="p">(</span>
            <span class="n">default_options</span><span class="p">,</span> <span class="n">actor_options</span>
        <span class="p">)</span>
        <span class="n">ray_option_utils</span><span class="o">.</span><span class="n">validate_actor_options</span><span class="p">(</span><span class="n">updated_options</span><span class="p">,</span> <span class="n">in_options</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># only update runtime_env when &quot;.options()&quot; specifies new runtime_env</span>
        <span class="k">if</span> <span class="s2">&quot;runtime_env&quot;</span> <span class="ow">in</span> <span class="n">actor_options</span><span class="p">:</span>
            <span class="n">updated_options</span><span class="p">[</span><span class="s2">&quot;runtime_env&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_runtime_env_for_task_or_actor</span><span class="p">(</span>
                <span class="n">updated_options</span><span class="p">[</span><span class="s2">&quot;runtime_env&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">class</span><span class="w"> </span><span class="nc">ActorOptionWrapper</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">remote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">actor_cls</span><span class="o">.</span><span class="n">_remote</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">updated_options</span><span class="p">)</span>

            <span class="nd">@DeveloperAPI</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                For Ray DAG building that creates static graph from decorated</span>
<span class="sd">                class or functions.</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">ray.dag.class_node</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClassNode</span>

                <span class="k">return</span> <span class="n">ClassNode</span><span class="p">(</span>
                    <span class="n">actor_cls</span><span class="o">.</span><span class="n">__ray_metadata__</span><span class="o">.</span><span class="n">modified_class</span><span class="p">,</span>
                    <span class="n">args</span><span class="p">,</span>
                    <span class="n">kwargs</span><span class="p">,</span>
                    <span class="n">updated_options</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">ActorOptionWrapper</span><span class="p">()</span>

    <span class="nd">@wrap_auto_init</span>
    <span class="nd">@_tracing_actor_creation</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_remote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">actor_options</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ActorProxy</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an actor.</span>

<span class="sd">        This method allows more flexibility than the remote method because</span>
<span class="sd">        resource requirements can be specified and override the defaults in the</span>
<span class="sd">        decorator.</span>

<span class="sd">        Args:</span>
<span class="sd">            args: The arguments to forward to the actor constructor.</span>
<span class="sd">            kwargs: The keyword arguments to forward to the actor constructor.</span>
<span class="sd">            num_cpus: The number of CPUs required by the actor creation task.</span>
<span class="sd">            num_gpus: The number of GPUs required by the actor creation task.</span>
<span class="sd">            memory: Restrict the heap memory usage of this actor.</span>
<span class="sd">            resources: The custom resources required by the actor creation</span>
<span class="sd">                task.</span>
<span class="sd">            max_concurrency: The max number of concurrent calls to allow for</span>
<span class="sd">                this actor. This only works with direct actor calls. The max</span>
<span class="sd">                concurrency defaults to 1 for threaded execution, and 1000 for</span>
<span class="sd">                asyncio execution. Note that the execution order is not</span>
<span class="sd">                guaranteed when max_concurrency &gt; 1.</span>
<span class="sd">            name: The globally unique name for the actor, which can be used</span>
<span class="sd">                to retrieve the actor via ray.get_actor(name) as long as the</span>
<span class="sd">                actor is still alive.</span>
<span class="sd">            namespace: Override the namespace to use for the actor. By default,</span>
<span class="sd">                actors are created in an anonymous namespace. The actor can</span>
<span class="sd">                be retrieved via ray.get_actor(name=name, namespace=namespace).</span>
<span class="sd">            lifetime: Either `None`, which defaults to the actor will fate</span>
<span class="sd">                share with its creator and will be deleted once its refcount</span>
<span class="sd">                drops to zero, or &quot;detached&quot;, which means the actor will live</span>
<span class="sd">                as a global object independent of the creator.</span>
<span class="sd">            placement_group: (This has been deprecated, please use</span>
<span class="sd">                `PlacementGroupSchedulingStrategy` scheduling_strategy)</span>
<span class="sd">                the placement group this actor belongs to,</span>
<span class="sd">                or None if it doesn&#39;t belong to any group. Setting to &quot;default&quot;</span>
<span class="sd">                autodetects the placement group based on the current setting of</span>
<span class="sd">                placement_group_capture_child_tasks.</span>
<span class="sd">            placement_group_bundle_index: (This has been deprecated, please use</span>
<span class="sd">                `PlacementGroupSchedulingStrategy` scheduling_strategy)</span>
<span class="sd">                the index of the bundle</span>
<span class="sd">                if the actor belongs to a placement group, which may be -1 to</span>
<span class="sd">                specify any available bundle.</span>
<span class="sd">            placement_group_capture_child_tasks: (This has been deprecated,</span>
<span class="sd">                please use `PlacementGroupSchedulingStrategy`</span>
<span class="sd">                scheduling_strategy)</span>
<span class="sd">                Whether or not children tasks</span>
<span class="sd">                of this actor should implicitly use the same placement group</span>
<span class="sd">                as its parent. It is False by default.</span>
<span class="sd">            runtime_env (Dict[str, Any]): Specifies the runtime environment for</span>
<span class="sd">                this actor or task and its children (see</span>
<span class="sd">                :ref:`runtime-environments` for details).</span>
<span class="sd">            max_pending_calls: Set the max number of pending calls</span>
<span class="sd">                allowed on the actor handle. When this value is exceeded,</span>
<span class="sd">                PendingCallsLimitExceeded will be raised for further tasks.</span>
<span class="sd">                Note that this limit is counted per handle. -1 means that the</span>
<span class="sd">                number of pending calls is unlimited.</span>
<span class="sd">            scheduling_strategy: Strategy about how to schedule this actor.</span>
<span class="sd">            enable_task_events: True if tracing is enabled, i.e., task events from</span>
<span class="sd">                the actor should be reported. Defaults to True.</span>
<span class="sd">            _labels: The key-value labels of the actor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A handle to the newly created actor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">actor_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="n">namespace</span> <span class="o">=</span> <span class="n">actor_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;namespace&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;name must be None or a string, got: &#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Actor name cannot be an empty string.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">namespace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ray</span><span class="o">.</span><span class="n">_private</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">validate_namespace</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>

        <span class="c1"># Handle the get-or-create case.</span>
        <span class="k">if</span> <span class="n">actor_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;get_if_exists&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ray</span><span class="o">.</span><span class="n">get_actor</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="c1"># Attempt to create it (may race with other attempts).</span>
                <span class="n">updated_options</span> <span class="o">=</span> <span class="n">actor_options</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">updated_options</span><span class="p">[</span><span class="s2">&quot;get_if_exists&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># prevent infinite loop</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">updated_options</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="c1"># We lost the creation race, ignore.</span>
                    <span class="k">pass</span>
                <span class="k">return</span> <span class="n">ray</span><span class="o">.</span><span class="n">get_actor</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>

        <span class="c1"># We pop the &quot;concurrency_groups&quot; coming from &quot;@ray.remote&quot; here. We no longer</span>
        <span class="c1"># need it in &quot;_remote()&quot;.</span>
        <span class="n">actor_options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;concurrency_groups&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ray_metadata__</span>
        <span class="n">is_asyncio</span> <span class="o">=</span> <span class="n">has_async_methods</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">modified_class</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">actor_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_concurrency&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">actor_options</span><span class="p">[</span><span class="s2">&quot;max_concurrency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ray_constants</span><span class="o">.</span><span class="n">DEFAULT_MAX_CONCURRENCY_ASYNC</span>
                <span class="k">if</span> <span class="n">is_asyncio</span>
                <span class="k">else</span> <span class="n">ray_constants</span><span class="o">.</span><span class="n">DEFAULT_MAX_CONCURRENCY_THREADED</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">client_mode_should_convert</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">client_mode_convert_actor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">actor_options</span><span class="p">)</span>

        <span class="c1"># fill actor required options</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ray_option_utils</span><span class="o">.</span><span class="n">actor_options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">actor_options</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">actor_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">default_value</span><span class="p">)</span>
        <span class="c1"># &quot;concurrency_groups&quot; already takes effects and should not apply again.</span>
        <span class="c1"># Remove the default value here.</span>
        <span class="n">actor_options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;concurrency_groups&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># TODO(suquark): cleanup these fields</span>
        <span class="n">max_concurrency</span> <span class="o">=</span> <span class="n">actor_options</span><span class="p">[</span><span class="s2">&quot;max_concurrency&quot;</span><span class="p">]</span>
        <span class="n">lifetime</span> <span class="o">=</span> <span class="n">actor_options</span><span class="p">[</span><span class="s2">&quot;lifetime&quot;</span><span class="p">]</span>
        <span class="n">runtime_env</span> <span class="o">=</span> <span class="n">actor_options</span><span class="p">[</span><span class="s2">&quot;runtime_env&quot;</span><span class="p">]</span>
        <span class="n">placement_group</span> <span class="o">=</span> <span class="n">actor_options</span><span class="p">[</span><span class="s2">&quot;placement_group&quot;</span><span class="p">]</span>
        <span class="n">placement_group_bundle_index</span> <span class="o">=</span> <span class="n">actor_options</span><span class="p">[</span><span class="s2">&quot;placement_group_bundle_index&quot;</span><span class="p">]</span>
        <span class="n">placement_group_capture_child_tasks</span> <span class="o">=</span> <span class="n">actor_options</span><span class="p">[</span>
            <span class="s2">&quot;placement_group_capture_child_tasks&quot;</span>
        <span class="p">]</span>
        <span class="n">scheduling_strategy</span> <span class="o">=</span> <span class="n">actor_options</span><span class="p">[</span><span class="s2">&quot;scheduling_strategy&quot;</span><span class="p">]</span>
        <span class="n">max_restarts</span> <span class="o">=</span> <span class="n">actor_options</span><span class="p">[</span><span class="s2">&quot;max_restarts&quot;</span><span class="p">]</span>
        <span class="n">max_task_retries</span> <span class="o">=</span> <span class="n">actor_options</span><span class="p">[</span><span class="s2">&quot;max_task_retries&quot;</span><span class="p">]</span>
        <span class="n">max_pending_calls</span> <span class="o">=</span> <span class="n">actor_options</span><span class="p">[</span><span class="s2">&quot;max_pending_calls&quot;</span><span class="p">]</span>

        <span class="c1"># Override enable_task_events to default for actor if not specified (i.e. None)</span>
        <span class="n">enable_task_events</span> <span class="o">=</span> <span class="n">actor_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enable_task_events&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">scheduling_strategy</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">scheduling_strategy</span><span class="p">,</span> <span class="n">PlacementGroupSchedulingStrategy</span>
        <span class="p">):</span>
            <span class="n">_warn_if_using_deprecated_placement_group</span><span class="p">(</span><span class="n">actor_options</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">worker</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">_private</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">global_worker</span>
        <span class="n">worker</span><span class="o">.</span><span class="n">check_connected</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">worker</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="n">ray</span><span class="o">.</span><span class="n">_private</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">WORKER_MODE</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">ray._private.usage</span><span class="w"> </span><span class="kn">import</span> <span class="n">usage_lib</span>

            <span class="n">usage_lib</span><span class="o">.</span><span class="n">record_library_usage</span><span class="p">(</span><span class="s2">&quot;core&quot;</span><span class="p">)</span>

        <span class="c1"># Check whether the name is already taken.</span>
        <span class="c1"># TODO(edoakes): this check has a race condition because two drivers</span>
        <span class="c1"># could pass the check and then create the same named actor. We should</span>
        <span class="c1"># instead check this when we create the actor, but that&#39;s currently an</span>
        <span class="c1"># async call.</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ray</span><span class="o">.</span><span class="n">get_actor</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Name is not taken.</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (namespace=</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">) is already &quot;</span>
                    <span class="s2">&quot;taken. Please use &quot;</span>
                    <span class="s2">&quot;a different name or get the existing actor using &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;ray.get_actor(&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;, namespace=&#39;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">lifetime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">detached</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">lifetime</span> <span class="o">==</span> <span class="s2">&quot;detached&quot;</span><span class="p">:</span>
            <span class="n">detached</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">lifetime</span> <span class="o">==</span> <span class="s2">&quot;non_detached&quot;</span><span class="p">:</span>
            <span class="n">detached</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;actor `lifetime` argument must be one of &#39;detached&#39;, &quot;</span>
                <span class="s2">&quot;&#39;non_detached&#39; and &#39;None&#39;.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># LOCAL_MODE cannot handle cross_language</span>
        <span class="k">if</span> <span class="n">worker</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">ray</span><span class="o">.</span><span class="n">LOCAL_MODE</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">meta</span><span class="o">.</span><span class="n">is_cross_language</span>
            <span class="p">),</span> <span class="s2">&quot;Cross language ActorClass cannot be executed locally.&quot;</span>

        <span class="c1"># Export the actor.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">meta</span><span class="o">.</span><span class="n">is_cross_language</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">last_export_cluster_and_job</span> <span class="o">!=</span> <span class="n">worker</span><span class="o">.</span><span class="n">current_cluster_and_job</span>
        <span class="p">):</span>
            <span class="c1"># If this actor class was not exported in this cluster and job,</span>
            <span class="c1"># we need to export this function again, because current GCS</span>
            <span class="c1"># doesn&#39;t have it.</span>

            <span class="c1"># After serialize / deserialize modified class, the __module__</span>
            <span class="c1"># of modified class will be ray.cloudpickle.cloudpickle.</span>
            <span class="c1"># So, here pass actor_creation_function_descriptor to make</span>
            <span class="c1"># sure export actor class correct.</span>
            <span class="n">worker</span><span class="o">.</span><span class="n">function_actor_manager</span><span class="o">.</span><span class="n">export_actor_class</span><span class="p">(</span>
                <span class="n">meta</span><span class="o">.</span><span class="n">modified_class</span><span class="p">,</span>
                <span class="n">meta</span><span class="o">.</span><span class="n">actor_creation_function_descriptor</span><span class="p">,</span>
                <span class="n">meta</span><span class="o">.</span><span class="n">method_meta</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">last_export_cluster_and_job</span> <span class="o">=</span> <span class="n">worker</span><span class="o">.</span><span class="n">current_cluster_and_job</span>

        <span class="n">resources</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">_common</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">resources_from_ray_options</span><span class="p">(</span><span class="n">actor_options</span><span class="p">)</span>
        <span class="c1"># Set the actor&#39;s default resources if not already set. First three</span>
        <span class="c1"># conditions are to check that no resources were specified in the</span>
        <span class="c1"># decorator. Last three conditions are to check that no resources were</span>
        <span class="c1"># specified when _remote() was called.</span>
        <span class="c1"># TODO(suquark): In the original code, memory is not considered as resources,</span>
        <span class="c1"># when deciding the default CPUs. It is strange, but we keep the original</span>
        <span class="c1"># semantics in case that it breaks user applications &amp; tests.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">resources</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">({</span><span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="s2">&quot;object_store_memory&quot;</span><span class="p">}):</span>
            <span class="c1"># In the default case, actors acquire no resources for</span>
            <span class="c1"># their lifetime, and actor methods will require 1 CPU.</span>
            <span class="n">resources</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;CPU&quot;</span><span class="p">,</span> <span class="n">ray_constants</span><span class="o">.</span><span class="n">DEFAULT_ACTOR_CREATION_CPU_SIMPLE</span><span class="p">)</span>
            <span class="n">actor_method_cpu</span> <span class="o">=</span> <span class="n">ray_constants</span><span class="o">.</span><span class="n">DEFAULT_ACTOR_METHOD_CPU_SIMPLE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If any resources are specified (here or in decorator), then</span>
            <span class="c1"># all resources are acquired for the actor&#39;s lifetime and no</span>
            <span class="c1"># resources are associated with methods.</span>
            <span class="n">resources</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
                <span class="s2">&quot;CPU&quot;</span><span class="p">,</span> <span class="n">ray_constants</span><span class="o">.</span><span class="n">DEFAULT_ACTOR_CREATION_CPU_SPECIFIED</span>
            <span class="p">)</span>
            <span class="n">actor_method_cpu</span> <span class="o">=</span> <span class="n">ray_constants</span><span class="o">.</span><span class="n">DEFAULT_ACTOR_METHOD_CPU_SPECIFIED</span>

        <span class="c1"># If the actor methods require CPU resources, then set the required</span>
        <span class="c1"># placement resources. If actor_placement_resources is empty, then</span>
        <span class="c1"># the required placement resources will be the same as resources.</span>
        <span class="n">actor_placement_resources</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">assert</span> <span class="n">actor_method_cpu</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">actor_method_cpu</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">actor_placement_resources</span> <span class="o">=</span> <span class="n">resources</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">actor_placement_resources</span><span class="p">[</span><span class="s2">&quot;CPU&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">meta</span><span class="o">.</span><span class="n">is_cross_language</span><span class="p">:</span>
            <span class="n">creation_args</span> <span class="o">=</span> <span class="n">cross_language</span><span class="o">.</span><span class="n">_format_args</span><span class="p">(</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">function_signature</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">method_meta</span><span class="o">.</span><span class="n">signatures</span><span class="p">[</span><span class="s2">&quot;__init__&quot;</span><span class="p">]</span>
            <span class="n">creation_args</span> <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="n">flatten_args</span><span class="p">(</span><span class="n">function_signature</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">scheduling_strategy</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">scheduling_strategy</span><span class="p">,</span> <span class="n">PlacementGroupSchedulingStrategy</span>
        <span class="p">):</span>
            <span class="c1"># TODO(jjyao) Clean this up once the</span>
            <span class="c1"># placement_group option is removed.</span>
            <span class="c1"># We should also consider pushing this logic down to c++</span>
            <span class="c1"># so that it can be reused by all languages.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scheduling_strategy</span><span class="p">,</span> <span class="n">PlacementGroupSchedulingStrategy</span><span class="p">):</span>
                <span class="n">placement_group</span> <span class="o">=</span> <span class="n">scheduling_strategy</span><span class="o">.</span><span class="n">placement_group</span>
                <span class="n">placement_group_bundle_index</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">scheduling_strategy</span><span class="o">.</span><span class="n">placement_group_bundle_index</span>
                <span class="p">)</span>
                <span class="n">placement_group_capture_child_tasks</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">scheduling_strategy</span><span class="o">.</span><span class="n">placement_group_capture_child_tasks</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">placement_group_capture_child_tasks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">placement_group_capture_child_tasks</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">worker</span><span class="o">.</span><span class="n">should_capture_child_tasks_in_placement_group</span>
                <span class="p">)</span>
            <span class="n">placement_group</span> <span class="o">=</span> <span class="n">_configure_placement_group_based_on_context</span><span class="p">(</span>
                <span class="n">placement_group_capture_child_tasks</span><span class="p">,</span>
                <span class="n">placement_group_bundle_index</span><span class="p">,</span>
                <span class="n">resources</span><span class="p">,</span>
                <span class="n">actor_placement_resources</span><span class="p">,</span>
                <span class="n">meta</span><span class="o">.</span><span class="n">class_name</span><span class="p">,</span>
                <span class="n">placement_group</span><span class="o">=</span><span class="n">placement_group</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">placement_group</span><span class="o">.</span><span class="n">is_empty</span><span class="p">:</span>
                <span class="n">scheduling_strategy</span> <span class="o">=</span> <span class="n">PlacementGroupSchedulingStrategy</span><span class="p">(</span>
                    <span class="n">placement_group</span><span class="p">,</span>
                    <span class="n">placement_group_bundle_index</span><span class="p">,</span>
                    <span class="n">placement_group_capture_child_tasks</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scheduling_strategy</span> <span class="o">=</span> <span class="s2">&quot;DEFAULT&quot;</span>

        <span class="n">serialized_runtime_env_info</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">runtime_env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">serialized_runtime_env_info</span> <span class="o">=</span> <span class="n">get_runtime_env_info</span><span class="p">(</span>
                <span class="n">runtime_env</span><span class="p">,</span>
                <span class="n">is_job_runtime_env</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">serialize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">concurrency_groups_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">meta</span><span class="o">.</span><span class="n">concurrency_groups</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">concurrency_groups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cg_name</span> <span class="ow">in</span> <span class="n">meta</span><span class="o">.</span><span class="n">concurrency_groups</span><span class="p">:</span>
            <span class="n">concurrency_groups_dict</span><span class="p">[</span><span class="n">cg_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">cg_name</span><span class="p">,</span>
                <span class="s2">&quot;max_concurrency&quot;</span><span class="p">:</span> <span class="n">meta</span><span class="o">.</span><span class="n">concurrency_groups</span><span class="p">[</span><span class="n">cg_name</span><span class="p">],</span>
                <span class="s2">&quot;function_descriptors&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="p">}</span>

        <span class="c1"># Update methods</span>
        <span class="k">for</span> <span class="n">method_name</span> <span class="ow">in</span> <span class="n">meta</span><span class="o">.</span><span class="n">method_meta</span><span class="o">.</span><span class="n">concurrency_group_for_methods</span><span class="p">:</span>
            <span class="n">cg_name</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">method_meta</span><span class="o">.</span><span class="n">concurrency_group_for_methods</span><span class="p">[</span><span class="n">method_name</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">cg_name</span> <span class="ow">in</span> <span class="n">concurrency_groups_dict</span>

            <span class="n">module_name</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">actor_creation_function_descriptor</span><span class="o">.</span><span class="n">module_name</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">actor_creation_function_descriptor</span><span class="o">.</span><span class="n">class_name</span>
            <span class="n">concurrency_groups_dict</span><span class="p">[</span><span class="n">cg_name</span><span class="p">][</span><span class="s2">&quot;function_descriptors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">PythonFunctionDescriptor</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Update the creation descriptor based on number of arguments</span>
        <span class="k">if</span> <span class="n">meta</span><span class="o">.</span><span class="n">is_cross_language</span><span class="p">:</span>
            <span class="n">func_name</span> <span class="o">=</span> <span class="s2">&quot;&lt;init&gt;&quot;</span>
            <span class="k">if</span> <span class="n">meta</span><span class="o">.</span><span class="n">language</span> <span class="o">==</span> <span class="n">Language</span><span class="o">.</span><span class="n">CPP</span><span class="p">:</span>
                <span class="n">func_name</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">actor_creation_function_descriptor</span><span class="o">.</span><span class="n">function_name</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">actor_creation_function_descriptor</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">cross_language</span><span class="o">.</span><span class="n">_get_function_descriptor_for_actor_method</span><span class="p">(</span>
                    <span class="n">meta</span><span class="o">.</span><span class="n">language</span><span class="p">,</span>
                    <span class="n">meta</span><span class="o">.</span><span class="n">actor_creation_function_descriptor</span><span class="p">,</span>
                    <span class="n">func_name</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)),</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">actor_id</span> <span class="o">=</span> <span class="n">worker</span><span class="o">.</span><span class="n">core_worker</span><span class="o">.</span><span class="n">create_actor</span><span class="p">(</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">language</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">actor_creation_function_descriptor</span><span class="p">,</span>
            <span class="n">creation_args</span><span class="p">,</span>
            <span class="n">max_restarts</span><span class="p">,</span>
            <span class="n">max_task_retries</span><span class="p">,</span>
            <span class="n">resources</span><span class="p">,</span>
            <span class="n">actor_placement_resources</span><span class="p">,</span>
            <span class="n">max_concurrency</span><span class="p">,</span>
            <span class="n">detached</span><span class="p">,</span>
            <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">namespace</span> <span class="k">if</span> <span class="n">namespace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">is_asyncio</span><span class="p">,</span>
            <span class="c1"># Store actor_method_cpu in actor handle&#39;s extension data.</span>
            <span class="n">extension_data</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">actor_method_cpu</span><span class="p">),</span>
            <span class="n">serialized_runtime_env_info</span><span class="o">=</span><span class="n">serialized_runtime_env_info</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">concurrency_groups_dict</span><span class="o">=</span><span class="n">concurrency_groups_dict</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">(),</span>
            <span class="n">max_pending_calls</span><span class="o">=</span><span class="n">max_pending_calls</span><span class="p">,</span>
            <span class="n">scheduling_strategy</span><span class="o">=</span><span class="n">scheduling_strategy</span><span class="p">,</span>
            <span class="n">enable_task_events</span><span class="o">=</span><span class="n">enable_task_events</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">actor_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_labels&quot;</span><span class="p">),</span>
            <span class="n">label_selector</span><span class="o">=</span><span class="n">actor_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label_selector&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">_actor_launch_hook</span><span class="p">:</span>
            <span class="n">_actor_launch_hook</span><span class="p">(</span>
                <span class="n">meta</span><span class="o">.</span><span class="n">actor_creation_function_descriptor</span><span class="p">,</span> <span class="n">resources</span><span class="p">,</span> <span class="n">scheduling_strategy</span>
            <span class="p">)</span>

        <span class="n">actor_handle</span> <span class="o">=</span> <span class="n">ActorHandle</span><span class="p">(</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">language</span><span class="p">,</span>
            <span class="n">actor_id</span><span class="p">,</span>
            <span class="n">max_task_retries</span><span class="p">,</span>
            <span class="n">enable_task_events</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">method_meta</span><span class="o">.</span><span class="n">method_is_generator</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">method_meta</span><span class="o">.</span><span class="n">decorators</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">method_meta</span><span class="o">.</span><span class="n">signatures</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">method_meta</span><span class="o">.</span><span class="n">num_returns</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">method_meta</span><span class="o">.</span><span class="n">max_task_retries</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">method_meta</span><span class="o">.</span><span class="n">retry_exceptions</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">method_meta</span><span class="o">.</span><span class="n">generator_backpressure_num_objects</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">method_meta</span><span class="o">.</span><span class="n">enable_task_events</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">method_meta</span><span class="o">.</span><span class="n">method_name_to_tensor_transport</span><span class="p">,</span>
            <span class="n">actor_method_cpu</span><span class="p">,</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">actor_creation_function_descriptor</span><span class="p">,</span>
            <span class="n">worker</span><span class="o">.</span><span class="n">current_cluster_and_job</span><span class="p">,</span>
            <span class="n">original_handle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">actor_handle</span>

    <span class="nd">@DeveloperAPI</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For Ray DAG building that creates static graph from decorated</span>
<span class="sd">        class or functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">ray.dag.class_node</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClassNode</span>

        <span class="k">return</span> <span class="n">ClassNode</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ray_metadata__</span><span class="o">.</span><span class="n">modified_class</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_options</span>
        <span class="p">)</span>


<span class="nd">@PublicAPI</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ActorHandle</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A handle to an actor.</span>

<span class="sd">    The fields in this class are prefixed with _ray_ to hide them from the user</span>
<span class="sd">    and to avoid collision with actor method names.</span>

<span class="sd">    An ActorHandle can be created in three ways. First, by calling .remote() on</span>
<span class="sd">    an ActorClass. Second, by passing an actor handle into a task (forking the</span>
<span class="sd">    ActorHandle). Third, by directly serializing the ActorHandle (e.g., with</span>
<span class="sd">    cloudpickle).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        _ray_actor_language: The actor language.</span>
<span class="sd">        _ray_actor_id: Actor ID.</span>
<span class="sd">        _ray_enable_task_events: The default value of whether task events is</span>
<span class="sd">            enabled, i.e., task events from the actor should be reported.</span>
<span class="sd">        _ray_method_is_generator: Map of method name -&gt; if it is a generator</span>
<span class="sd">            method.</span>
<span class="sd">        _ray_method_decorators: Optional decorators for the function</span>
<span class="sd">            invocation. This can be used to change the behavior on the</span>
<span class="sd">            invocation side, whereas a regular decorator can be used to change</span>
<span class="sd">            the behavior on the execution side.</span>
<span class="sd">        _ray_method_signatures: The signatures of the actor methods.</span>
<span class="sd">        _ray_method_max_task_retries: Max number of retries on method failure.</span>
<span class="sd">        _ray_method_num_returns: The default number of return values for</span>
<span class="sd">            each method.</span>
<span class="sd">        _ray_method_retry_exceptions: The default value of boolean of whether you want</span>
<span class="sd">            to retry all user-raised exceptions, or a list of allowlist exceptions to</span>
<span class="sd">            retry.</span>
<span class="sd">        _ray_method_generator_backpressure_num_objects: Generator-only</span>
<span class="sd">            config. The max number of objects to generate before it</span>
<span class="sd">            starts pausing a generator.</span>
<span class="sd">        _ray_method_enable_task_events: The value of whether task</span>
<span class="sd">            tracing is enabled for the actor methods. This overrides the</span>
<span class="sd">            actor&#39;s default value (`_ray_enable_task_events`).</span>
<span class="sd">        _ray_method_name_to_tensor_transport: A dictionary mapping method names to their tensor transport protocol settings.</span>
<span class="sd">            The valid values are OBJECT_STORE (default), NCCL, or GLOO, and they are case-insensitive.</span>
<span class="sd">        _ray_actor_method_cpus: The number of CPUs required by actor methods.</span>
<span class="sd">        _ray_original_handle: True if this is the original actor handle for a</span>
<span class="sd">            given actor. If this is true, then the actor will be destroyed when</span>
<span class="sd">            this handle goes out of scope.</span>
<span class="sd">        _ray_weak_ref: True means that this handle does not count towards the</span>
<span class="sd">            distributed ref count for the actor, i.e. the actor may be GCed</span>
<span class="sd">            while this handle is still in scope. This is set to True if the</span>
<span class="sd">            handle was created by getting an actor by name or by getting the</span>
<span class="sd">            self handle. It is set to False if this is the original handle or</span>
<span class="sd">            if it was created by passing the original handle through task args</span>
<span class="sd">            and returns.</span>
<span class="sd">        _ray_is_cross_language: Whether this actor is cross language.</span>
<span class="sd">        _ray_actor_creation_function_descriptor: The function descriptor</span>
<span class="sd">            of the actor creation task.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">language</span><span class="p">,</span>
        <span class="n">actor_id</span><span class="p">,</span>
        <span class="n">max_task_retries</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">enable_task_events</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">method_is_generator</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span>
        <span class="n">method_decorators</span><span class="p">,</span>
        <span class="n">method_signatures</span><span class="p">,</span>
        <span class="n">method_num_returns</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;streaming&quot;</span><span class="p">]]],</span>
        <span class="n">method_max_task_retries</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">method_retry_exceptions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]],</span>
        <span class="n">method_generator_backpressure_num_objects</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">method_enable_task_events</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span>
        <span class="n">method_name_to_tensor_transport</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TensorTransportEnum</span><span class="p">],</span>
        <span class="n">actor_method_cpus</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">actor_creation_function_descriptor</span><span class="p">,</span>
        <span class="n">cluster_and_job</span><span class="p">,</span>
        <span class="n">original_handle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">weak_ref</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize an ActorHandle.</span>

<span class="sd">        Args:</span>
<span class="sd">            language: The actor language.</span>
<span class="sd">            actor_id: The ID of the actor.</span>
<span class="sd">            max_task_retries: The maximum number of times to retry a task when it fails.</span>
<span class="sd">            enable_task_events: Whether task events should be enabled for this actor.</span>
<span class="sd">            method_is_generator: Dictionary mapping method names to whether they are generator methods.</span>
<span class="sd">            method_decorators: Dictionary mapping method names to their decorators.</span>
<span class="sd">            method_signatures: Dictionary mapping method names to their signatures.</span>
<span class="sd">            method_num_returns: Dictionary mapping method names to their number of return values.</span>
<span class="sd">            method_max_task_retries: Dictionary mapping method names to their maximum task retries.</span>
<span class="sd">            method_retry_exceptions: Dictionary mapping method names to their retry exception settings.</span>
<span class="sd">            method_generator_backpressure_num_objects: Dictionary mapping method names to their generator backpressure settings.</span>
<span class="sd">            method_enable_task_events: Dictionary mapping method names to whether task events are enabled.</span>
<span class="sd">            method_name_to_tensor_transport: Dictionary mapping method names to their tensor transport settings.</span>
<span class="sd">            actor_method_cpus: The number of CPUs required by actor methods.</span>
<span class="sd">            actor_creation_function_descriptor: The function descriptor for actor creation.</span>
<span class="sd">            cluster_and_job: The cluster and job information.</span>
<span class="sd">            original_handle: Whether this is the original actor handle.</span>
<span class="sd">            weak_ref: Whether this is a weak reference to the actor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_language</span> <span class="o">=</span> <span class="n">language</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_id</span> <span class="o">=</span> <span class="n">actor_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_max_task_retries</span> <span class="o">=</span> <span class="n">max_task_retries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_original_handle</span> <span class="o">=</span> <span class="n">original_handle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_weak_ref</span> <span class="o">=</span> <span class="n">weak_ref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_enable_task_events</span> <span class="o">=</span> <span class="n">enable_task_events</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_is_generator</span> <span class="o">=</span> <span class="n">method_is_generator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_decorators</span> <span class="o">=</span> <span class="n">method_decorators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_signatures</span> <span class="o">=</span> <span class="n">method_signatures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_num_returns</span> <span class="o">=</span> <span class="n">method_num_returns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_max_task_retries</span> <span class="o">=</span> <span class="n">method_max_task_retries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_retry_exceptions</span> <span class="o">=</span> <span class="n">method_retry_exceptions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_generator_backpressure_num_objects</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">method_generator_backpressure_num_objects</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_enable_task_events</span> <span class="o">=</span> <span class="n">method_enable_task_events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_name_to_tensor_transport</span> <span class="o">=</span> <span class="n">method_name_to_tensor_transport</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_method_cpus</span> <span class="o">=</span> <span class="n">actor_method_cpus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_cluster_and_job</span> <span class="o">=</span> <span class="n">cluster_and_job</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_is_cross_language</span> <span class="o">=</span> <span class="n">language</span> <span class="o">!=</span> <span class="n">Language</span><span class="o">.</span><span class="n">PYTHON</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_creation_function_descriptor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">actor_creation_function_descriptor</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_function_descriptor</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># This is incremented each time `bind()` is called on an actor handle</span>
        <span class="c1"># (in Ray DAGs), therefore capturing the bind order of the actor methods.</span>
        <span class="c1"># TODO: this does not work properly if the caller has two copies of the</span>
        <span class="c1"># same actor handle, and needs to be fixed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_dag_bind_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_is_cross_language</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">actor_creation_function_descriptor</span><span class="p">,</span> <span class="n">PythonFunctionDescriptor</span>
            <span class="p">)</span>
            <span class="n">module_name</span> <span class="o">=</span> <span class="n">actor_creation_function_descriptor</span><span class="o">.</span><span class="n">module_name</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="n">actor_creation_function_descriptor</span><span class="o">.</span><span class="n">class_name</span>
            <span class="k">for</span> <span class="n">method_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_signatures</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">function_descriptor</span> <span class="o">=</span> <span class="n">PythonFunctionDescriptor</span><span class="p">(</span>
                    <span class="n">module_name</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">class_name</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ray_function_descriptor</span><span class="p">[</span><span class="n">method_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">function_descriptor</span>

        <span class="c1"># Build an _ActorMethodMetadata per method to cache expensive parsing logic.</span>
        <span class="c1"># The _ActorMethodMetadata doesn&#39;t take a reference to this ActorHandle to avoid a circular reference.</span>
        <span class="c1"># Instead, we will lazily bind this ActorHandle to the _ActorMethodMetadata when a method is invoked.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_method_shells</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">method_signature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_signatures</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_method_shells</span><span class="p">[</span><span class="n">method_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ActorMethodMetadata</span><span class="p">(</span>
                <span class="n">method_name</span><span class="o">=</span><span class="n">method_name</span><span class="p">,</span>
                <span class="n">num_returns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_num_returns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">max_task_retries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_max_task_retries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">method_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_max_task_retries</span>
                <span class="p">)</span>
                <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">retry_exceptions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_retry_exceptions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method_name</span><span class="p">),</span>
                <span class="n">is_generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_is_generator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method_name</span><span class="p">),</span>
                <span class="n">generator_backpressure_num_objects</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_generator_backpressure_num_objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">method_name</span>
                <span class="p">),</span>
                <span class="n">enable_task_events</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_enable_task_events</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">method_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_enable_task_events</span>
                <span class="p">),</span>
                <span class="n">decorator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_decorators</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method_name</span><span class="p">),</span>
                <span class="n">signature</span><span class="o">=</span><span class="n">method_signature</span><span class="p">,</span>
                <span class="n">tensor_transport</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_name_to_tensor_transport</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">method_name</span>
                <span class="p">),</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Weak references don&#39;t count towards the distributed ref count, so no</span>
        <span class="c1"># need to decrement the ref count.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_weak_ref</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Mark that this actor handle has gone out of scope. Once all actor</span>
            <span class="c1"># handles are out of scope, the actor will exit.</span>
            <span class="k">if</span> <span class="n">ray</span><span class="o">.</span><span class="n">_private</span><span class="o">.</span><span class="n">worker</span><span class="p">:</span>
                <span class="n">worker</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">_private</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">global_worker</span>
                <span class="k">if</span> <span class="n">worker</span><span class="o">.</span><span class="n">connected</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">worker</span><span class="p">,</span> <span class="s2">&quot;core_worker&quot;</span><span class="p">):</span>
                    <span class="n">worker</span><span class="o">.</span><span class="n">core_worker</span><span class="o">.</span><span class="n">remove_actor_handle_reference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c1"># Suppress the attribute error which is caused by</span>
            <span class="c1"># python destruction ordering issue.</span>
            <span class="c1"># It only happen when python exits.</span>
            <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_actor_method_call</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">num_returns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;streaming&quot;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_task_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">retry_exceptions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">concurrency_group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">generator_backpressure_num_objects</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">enable_task_events</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tensor_transport</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorTransportEnum</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method execution stub for an actor handle.</span>

<span class="sd">        This is the function that executes when</span>
<span class="sd">        `actor.method_name.remote(*args, **kwargs)` is called. Instead of</span>
<span class="sd">        executing locally, the method is packaged as a task and scheduled</span>
<span class="sd">        to the remote actor instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            method_name: The name of the actor method to execute.</span>
<span class="sd">            args: A list of arguments for the actor method.</span>
<span class="sd">            kwargs: A dictionary of keyword arguments for the actor method.</span>
<span class="sd">            name: The name to give the actor method call task.</span>
<span class="sd">            num_returns: The number of return values for the method.</span>
<span class="sd">            max_task_retries: Number of retries when method fails.</span>
<span class="sd">            retry_exceptions: Boolean of whether you want to retry all user-raised</span>
<span class="sd">                exceptions, or a list of allowlist exceptions to retry.</span>
<span class="sd">            concurrency_group_name: The name of the concurrency group to use.</span>
<span class="sd">            generator_backpressure_num_objects: The number of objects to generate</span>
<span class="sd">                before applying backpressure.</span>
<span class="sd">            enable_task_events: True if tracing is enabled, i.e., task events from</span>
<span class="sd">                the actor should be reported.</span>
<span class="sd">            tensor_transport: The tensor transport protocol to use for the actor method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            object_refs: A list of object refs returned by the remote actor</span>
<span class="sd">                method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">worker</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">_private</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">global_worker</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">args</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_is_cross_language</span><span class="p">:</span>
            <span class="n">list_args</span> <span class="o">=</span> <span class="n">cross_language</span><span class="o">.</span><span class="n">_format_args</span><span class="p">(</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
            <span class="n">function_descriptor</span> <span class="o">=</span> <span class="n">cross_language</span><span class="o">.</span><span class="n">_get_function_descriptor_for_actor_method</span><span class="p">(</span>  <span class="c1"># noqa: E501</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_language</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_creation_function_descriptor</span><span class="p">,</span>
                <span class="n">method_name</span><span class="p">,</span>
                <span class="c1"># The signature for xlang should be &quot;{length_of_arguments}&quot; to handle</span>
                <span class="c1"># overloaded methods.</span>
                <span class="n">signature</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">function_signature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_signatures</span><span class="p">[</span><span class="n">method_name</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">function_signature</span><span class="p">:</span>
                <span class="n">list_args</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">list_args</span> <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="n">flatten_args</span><span class="p">(</span><span class="n">function_signature</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
            <span class="n">function_descriptor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_function_descriptor</span><span class="p">[</span><span class="n">method_name</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">worker</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">ray</span><span class="o">.</span><span class="n">LOCAL_MODE</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_is_cross_language</span>
            <span class="p">),</span> <span class="s2">&quot;Cross language remote actor method cannot be executed locally.&quot;</span>

        <span class="k">if</span> <span class="n">num_returns</span> <span class="o">==</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">:</span>
            <span class="n">num_returns</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">num_returns</span> <span class="o">==</span> <span class="s2">&quot;streaming&quot;</span><span class="p">:</span>
            <span class="c1"># TODO(sang): This is a temporary private API.</span>
            <span class="c1"># Remove it when we migrate to the streaming generator.</span>
            <span class="n">num_returns</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">_raylet</span><span class="o">.</span><span class="n">STREAMING_GENERATOR_RETURN</span>

        <span class="n">retry_exception_allowlist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">retry_exceptions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">retry_exceptions</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">retry_exceptions</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">retry_exception_allowlist</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">retry_exceptions</span><span class="p">)</span>
            <span class="n">retry_exceptions</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">retry_exceptions</span><span class="p">,</span> <span class="nb">bool</span>
        <span class="p">),</span> <span class="s2">&quot;retry_exceptions can either be </span><span class="se">\</span>
<span class="s2">            boolean or list/tuple of exception types.&quot;</span>

        <span class="k">if</span> <span class="n">generator_backpressure_num_objects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">generator_backpressure_num_objects</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="n">object_refs</span> <span class="o">=</span> <span class="n">worker</span><span class="o">.</span><span class="n">core_worker</span><span class="o">.</span><span class="n">submit_actor_task</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_language</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_id</span><span class="p">,</span>
            <span class="n">function_descriptor</span><span class="p">,</span>
            <span class="n">list_args</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">num_returns</span><span class="p">,</span>
            <span class="n">max_task_retries</span><span class="p">,</span>
            <span class="n">retry_exceptions</span><span class="p">,</span>
            <span class="n">retry_exception_allowlist</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_method_cpus</span><span class="p">,</span>
            <span class="n">concurrency_group_name</span> <span class="k">if</span> <span class="n">concurrency_group_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">generator_backpressure_num_objects</span><span class="p">,</span>
            <span class="n">enable_task_events</span><span class="p">,</span>
            <span class="n">tensor_transport</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">num_returns</span> <span class="o">==</span> <span class="n">STREAMING_GENERATOR_RETURN</span><span class="p">:</span>
            <span class="c1"># Streaming generator will return a single ref</span>
            <span class="c1"># that is for the generator task.</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">object_refs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="n">generator_ref</span> <span class="o">=</span> <span class="n">object_refs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">ObjectRefGenerator</span><span class="p">(</span><span class="n">generator_ref</span><span class="p">,</span> <span class="n">worker</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">object_refs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">object_refs</span> <span class="o">=</span> <span class="n">object_refs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">object_refs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">object_refs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">object_refs</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle dynamic attribute access for actor methods.</span>

<span class="sd">        This method is called when accessing attributes that don&#39;t exist as direct</span>
<span class="sd">        instance attributes. It&#39;s the core mechanism for actor method invocation.</span>

<span class="sd">        For Python actors (99% of cases):</span>
<span class="sd">        - We use strict validation: only methods in _method_shells are allowed</span>
<span class="sd">        - This prevents typos and provides clear error messages</span>
<span class="sd">        - Returns a bound ActorMethod created from the cached _ActorMethodMetadata</span>

<span class="sd">        For cross-language actors:</span>
<span class="sd">        - We can&#39;t validate method names client-side (the target language defines them)</span>
<span class="sd">        - We allow arbitrary method calls to pass through</span>
<span class="sd">        - Some Python-specific methods like `__ray_terminate__` are blocked with warnings</span>

<span class="sd">        Args:</span>
<span class="sd">            item: The attribute/method name being accessed</span>

<span class="sd">        Returns:</span>
<span class="sd">            ActorMethod: A bound method ready for .remote() calls</span>

<span class="sd">        Raises:</span>
<span class="sd">            AttributeError: For Python actors when accessing non-existent methods</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If this name matches a remote method, bind and return it.</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method_shells</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_method_shells</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_is_cross_language</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; object has &quot;</span> <span class="sa">f</span><span class="s2">&quot;no attribute &#39;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;__ray_terminate__&quot;</span><span class="p">]:</span>

            <span class="k">class</span><span class="w"> </span><span class="nc">FakeActorMethod</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
                <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;Actor methods cannot be called directly. Instead &quot;</span>
                        <span class="s2">&quot;of running &#39;object.</span><span class="si">{}</span><span class="s2">()&#39;, try &#39;object.</span><span class="si">{}</span><span class="s2">.remote()&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">item</span><span class="p">,</span> <span class="n">item</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">remote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Actor method </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2"> is not supported by cross language.&quot;</span>
                    <span class="p">)</span>

            <span class="k">return</span> <span class="n">FakeActorMethod</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">ActorMethod</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>  <span class="c1"># actor</span>
            <span class="n">item</span><span class="p">,</span>  <span class="c1"># method_name</span>
            <span class="n">ray_constants</span><span class="o">.</span><span class="n">DEFAULT_ACTOR_METHOD_NUM_RETURN_VALS</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>  <span class="c1"># max_task_retries</span>
            <span class="kc">False</span><span class="p">,</span>  <span class="c1"># retry_exceptions</span>
            <span class="kc">False</span><span class="p">,</span>  <span class="c1"># is_generator</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_generator_backpressure_num_objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ray_enable_task_events</span><span class="p">,</span>  <span class="c1"># enable_task_events</span>
            <span class="c1"># Currently, cross-lang actor method not support decorator</span>
            <span class="n">decorator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">signature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Make tab completion work.</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_signatures</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s2">&quot;Actor(&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_creation_function_descriptor</span><span class="o">.</span><span class="n">class_name</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_actor_id</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_actor_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__value</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">hash</span><span class="p">(</span><span class="n">__value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_actor_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_local_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the local actor state.</span>

<span class="sd">        NOTE: this method only returns accurate actor state</span>
<span class="sd">        after a first actor method call is made against</span>
<span class="sd">        this actor handle due to https://github.com/ray-project/ray/pull/24600.</span>

<span class="sd">        Returns:</span>
<span class="sd">           ActorTableData.ActorState or None if the state is unknown.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">worker</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">_private</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">global_worker</span>
        <span class="n">worker</span><span class="o">.</span><span class="n">check_connected</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">worker</span><span class="o">.</span><span class="n">core_worker</span><span class="o">.</span><span class="n">get_local_actor_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_serialization_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This is defined in order to make pickling work.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary of the information needed to reconstruct the object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">worker</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">_private</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">global_worker</span>
        <span class="n">worker</span><span class="o">.</span><span class="n">check_connected</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">worker</span><span class="p">,</span> <span class="s2">&quot;core_worker&quot;</span><span class="p">):</span>
            <span class="c1"># Non-local mode</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">worker</span><span class="o">.</span><span class="n">core_worker</span><span class="o">.</span><span class="n">serialize_actor_handle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Local mode</span>
            <span class="n">state</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;actor_language&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_language</span><span class="p">,</span>
                    <span class="s2">&quot;actor_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_id</span><span class="p">,</span>
                    <span class="s2">&quot;max_task_retries&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_max_task_retries</span><span class="p">,</span>
                    <span class="s2">&quot;enable_task_events&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enable_task_events</span><span class="p">,</span>
                    <span class="s2">&quot;method_is_generator&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_is_generator</span><span class="p">,</span>
                    <span class="s2">&quot;method_decorators&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_decorators</span><span class="p">,</span>
                    <span class="s2">&quot;method_signatures&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_signatures</span><span class="p">,</span>
                    <span class="s2">&quot;method_num_returns&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_num_returns</span><span class="p">,</span>
                    <span class="s2">&quot;method_max_task_retries&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_max_task_retries</span><span class="p">,</span>
                    <span class="s2">&quot;method_retry_exceptions&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_retry_exceptions</span><span class="p">,</span>
                    <span class="s2">&quot;method_generator_backpressure_num_objects&quot;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_generator_backpressure_num_objects</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;method_enable_task_events&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_method_enable_task_events</span><span class="p">,</span>
                    <span class="s2">&quot;actor_method_cpus&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_method_cpus</span><span class="p">,</span>
                    <span class="s2">&quot;actor_creation_function_descriptor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_actor_creation_function_descriptor</span><span class="p">,</span>  <span class="c1"># noqa: E501</span>
                <span class="p">},</span>
                <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ray_weak_ref</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_deserialization_helper</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">weak_ref</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">outer_object_ref</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This is defined in order to make pickling work.</span>

<span class="sd">        Args:</span>
<span class="sd">            state: The serialized state of the actor handle.</span>
<span class="sd">            outer_object_ref: The ObjectRef that the serialized actor handle</span>
<span class="sd">                was contained in, if any. This is used for counting references</span>
<span class="sd">                to the actor handle.</span>
<span class="sd">            weak_ref: Whether this was serialized from an actor handle with a</span>
<span class="sd">                weak ref to the actor.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">worker</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">_private</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">global_worker</span>
        <span class="n">worker</span><span class="o">.</span><span class="n">check_connected</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">worker</span><span class="p">,</span> <span class="s2">&quot;core_worker&quot;</span><span class="p">):</span>
            <span class="c1"># Non-local mode</span>
            <span class="k">return</span> <span class="n">worker</span><span class="o">.</span><span class="n">core_worker</span><span class="o">.</span><span class="n">deserialize_and_register_actor_handle</span><span class="p">(</span>
                <span class="n">state</span><span class="p">,</span>
                <span class="n">outer_object_ref</span><span class="p">,</span>
                <span class="n">weak_ref</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Local mode</span>
            <span class="k">assert</span> <span class="n">worker</span><span class="o">.</span><span class="n">current_cluster_and_job</span> <span class="o">==</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;current_cluster_and_job&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
                <span class="c1"># TODO(swang): Accessing the worker&#39;s current task ID is not</span>
                <span class="c1"># thread-safe.</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;actor_language&quot;</span><span class="p">],</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;actor_id&quot;</span><span class="p">],</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;max_task_retries&quot;</span><span class="p">],</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;enable_task_events&quot;</span><span class="p">],</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;method_is_generator&quot;</span><span class="p">],</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;method_decorators&quot;</span><span class="p">],</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;method_signatures&quot;</span><span class="p">],</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;method_num_returns&quot;</span><span class="p">],</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;method_max_task_retries&quot;</span><span class="p">],</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;method_retry_exceptions&quot;</span><span class="p">],</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;method_generator_backpressure_num_objects&quot;</span><span class="p">],</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;method_enable_task_events&quot;</span><span class="p">],</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;actor_method_cpus&quot;</span><span class="p">],</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;actor_creation_function_descriptor&quot;</span><span class="p">],</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;current_cluster_and_job&quot;</span><span class="p">],</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This code path is used by pickling but not by Ray forking.&quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">serialized</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">weak_ref</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialization_helper</span><span class="p">()</span>
        <span class="c1"># There is no outer object ref when the actor handle is</span>
        <span class="c1"># deserialized out-of-band using pickle.</span>
        <span class="k">return</span> <span class="n">ActorHandle</span><span class="o">.</span><span class="n">_deserialization_helper</span><span class="p">,</span> <span class="p">(</span><span class="n">serialized</span><span class="p">,</span> <span class="n">weak_ref</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_modify_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="c1"># cls has been modified.</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;__ray_actor_class__&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span>

    <span class="c1"># Give an error if cls is an old-style class.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;The @ray.remote decorator cannot be applied to old-style &quot;</span>
            <span class="s2">&quot;classes. In Python 2, you must declare the class with &quot;</span>
            <span class="s2">&quot;&#39;class ClassName(object):&#39; instead of &#39;class ClassName:&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Modify the class to have additional default methods.</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Class</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">__ray_actor_class__</span> <span class="o">=</span> <span class="bp">cls</span>  <span class="c1"># The original actor class</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">__ray_ready__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">__ray_call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">__ray_terminate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">worker</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">_private</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">global_worker</span>
            <span class="k">if</span> <span class="n">worker</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="n">ray</span><span class="o">.</span><span class="n">LOCAL_MODE</span><span class="p">:</span>
                <span class="n">ray</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">exit_actor</span><span class="p">()</span>

    <span class="n">Class</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span>
    <span class="n">Class</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_function_or_method</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">Class</span><span class="p">,</span> <span class="s2">&quot;__init__&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
        <span class="c1"># Add __init__ if it does not exist.</span>
        <span class="c1"># Actor creation will be executed with __init__ together.</span>

        <span class="c1"># Assign an __init__ function will avoid many checks later on.</span>
        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="n">Class</span><span class="o">.</span><span class="fm">__init__</span> <span class="o">=</span> <span class="fm">__init__</span>

    <span class="k">return</span> <span class="n">Class</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_make_actor</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">actor_options</span><span class="p">):</span>
    <span class="n">Class</span> <span class="o">=</span> <span class="n">_modify_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
    <span class="n">_inject_tracing_into_class</span><span class="p">(</span><span class="n">Class</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;max_restarts&quot;</span> <span class="ow">in</span> <span class="n">actor_options</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">actor_options</span><span class="p">[</span><span class="s2">&quot;max_restarts&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># -1 represents infinite restart</span>
            <span class="c1"># Make sure we don&#39;t pass too big of an int to C++, causing</span>
            <span class="c1"># an overflow.</span>
            <span class="n">actor_options</span><span class="p">[</span><span class="s2">&quot;max_restarts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                <span class="n">actor_options</span><span class="p">[</span><span class="s2">&quot;max_restarts&quot;</span><span class="p">],</span> <span class="n">ray_constants</span><span class="o">.</span><span class="n">MAX_INT64_VALUE</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">ActorClass</span><span class="o">.</span><span class="n">_ray_from_modified_class</span><span class="p">(</span>
        <span class="n">Class</span><span class="p">,</span>
        <span class="n">ActorClassID</span><span class="o">.</span><span class="n">from_random</span><span class="p">(),</span>
        <span class="n">actor_options</span><span class="p">,</span>
    <span class="p">)</span>


<span class="nd">@PublicAPI</span>
<span class="k">def</span><span class="w"> </span><span class="nf">exit_actor</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Intentionally exit the current actor.</span>

<span class="sd">    This API can be used only inside an actor. Use ray.kill</span>
<span class="sd">    API if you&#39;d like to kill an actor using actor handle.</span>

<span class="sd">    When this API is called, an exception is raised and the actor</span>
<span class="sd">    will exit immediately. For asyncio actors, there may be a short</span>
<span class="sd">    delay before the actor exits if the API is called from a background</span>
<span class="sd">    task.</span>
<span class="sd">    Any queued methods will fail. Any ``atexit``</span>
<span class="sd">    handlers installed in the actor will be run.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: An exception is raised if this is a driver or this</span>
<span class="sd">            worker is not an actor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">worker</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">_private</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">global_worker</span>
    <span class="k">if</span> <span class="n">worker</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">ray</span><span class="o">.</span><span class="n">WORKER_MODE</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">worker</span><span class="o">.</span><span class="n">actor_id</span><span class="o">.</span><span class="n">is_nil</span><span class="p">():</span>
        <span class="n">worker</span><span class="o">.</span><span class="n">core_worker</span><span class="o">.</span><span class="n">set_current_actor_should_exit</span><span class="p">()</span>
        <span class="c1"># In asyncio actor mode, we can&#39;t raise SystemExit because it will just</span>
        <span class="c1"># quit the asycnio event loop thread, not the main thread. Instead, we</span>
        <span class="c1"># raise a custom error to the main thread to tell it to exit.</span>
        <span class="k">if</span> <span class="n">worker</span><span class="o">.</span><span class="n">core_worker</span><span class="o">.</span><span class="n">current_actor_is_asyncio</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">AsyncioActorExit</span><span class="p">()</span>

        <span class="c1"># Set a flag to indicate this is an intentional actor exit. This</span>
        <span class="c1"># reduces log verbosity.</span>
        <span class="n">raise_sys_exit_with_custom_error_message</span><span class="p">(</span><span class="s2">&quot;exit_actor() is called.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;exit_actor API is called on a non-actor worker, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">worker</span><span class="o">.</span><span class="n">mode</span><span class="si">}</span><span class="s2">. Call this API inside an actor methods&quot;</span>
            <span class="s2">&quot;if you&#39;d like to exit the actor gracefully.&quot;</span>
        <span class="p">)</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Andres Bermeo Marinelli
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>